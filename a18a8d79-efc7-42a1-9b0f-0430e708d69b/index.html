<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <title>UUabc</title>
    <meta name="viewport"
        content="width=device-width,initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="full-screen" content="true" />
    <meta name="screen-orientation" content="portrait" />
    <meta name="x5-fullscreen" content="true" />
    <meta name="360-fullscreen" content="true" />
    <link rel="stylesheet" href="./resource/style/videoComponent.css">
    <link rel="stylesheet" href="./resource/icon/style.css">
    <style>
        @font-face {
            font-family: "Muli-Black";
            src: url('./resource/fonts/Muli-Black.ttf');
        }

        @font-face {
            font-family: "Muli-BlackItalic";
            src: url('./resource/fonts/Muli-BlackItalic.ttf');
        }

        @font-face {
            font-family: "Muli-Bold";
            src: url('./resource/fonts/Muli-Bold.ttf');
        }

        @font-face {
            font-family: "Muli-BoldItalic";
            src: url('./resource/fonts/Muli-BoldItalic.ttf');
        }

        @font-face {
            font-family: "Muli-ExtraBold";
            src: url('./resource/fonts/Muli-ExtraBold.ttf');
        }

        @font-face {
            font-family: "Muli-ExtraBoldItalic";
            src: url('./resource/fonts/Muli-ExtraBoldItalic.ttf');
        }

        @font-face {
            font-family: "Muli-ExtraLight";
            src: url('./resource/fonts/Muli-ExtraLight.ttf');
        }

        @font-face {
            font-family: "Muli-ExtraLightItalic";
            src: url('./resource/fonts/Muli-ExtraLightItalic.ttf');
        }

        @font-face {
            font-family: "Muli-Italic";
            src: url('./resource/fonts/Muli-Italic.ttf');
        }

        @font-face {
            font-family: "Muli-Light";
            src: url('./resource/fonts/Muli-Light.ttf');
        }

        @font-face {
            font-family: "Muli-LightItalic";
            src: url('./resource/fonts/Muli-LightItalic.ttf');
        }

        @font-face {
            font-family: "Muli-SemiBold";
            src: url('./resource/fonts/Muli-SemiBold.ttf');
        }

        @font-face {
            font-family: "Muli-SemiBoldItalic";
            src: url('./resource/fonts/Muli-SemiBoldItalic.ttf');
        }

        @font-face {
            font-family: "Muli";
            src: url('./resource/fonts/Muli-Regular.ttf');
        }

        html,
        body {
            touch-action: none;
            /* background: #a0d049; */
            padding: 0;
            border: 0;
            margin: 0;
            height: 100%;

            overflow: hidden;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        #preloading {
            z-index: 1000;
            position: absolute;
            width: 100%;
            height: 100%;
            background: #FFD781;
            /* border-radius: 20px;  */
        }

        .btnBox {
            position: absolute;
            z-index: 100;
        }

        #preloading .main {
            width: 75%;
            margin: 0 auto;
            position: relative;
        }

        #preloading .main::after {
            content: '';
            width: 100%;
            height: 50%;
            position: absolute;
            bottom: 0;
            left: 0;
            background: #FFD781;
        }

        #preloading .main .bg {
            animation: Incircle 8s infinite linear;
            width: 100%;
        }

        #preloading .main .logo {
            position: absolute;
            bottom: 25%;
            left: 17%;
            width: 66%;
            z-index: 99;
            /* animation: shaky-slow 5s running; */
        }

        #preloading .progress {
            width: 38%;
            height: 8px;
            background: #EAB268;
            position: absolute;
            bottom: 15%;
            left: 31%;
            border-radius: 4px;
        }

        #preloading .msgCover {
            width: 38%;
            position: absolute;
            color: #666;
            font-size: 12px;
            text-align: center;
            bottom: 11%;
            left: 31%;
            border-radius: 4px;
        }

        #preloading .progress .item {
            width: 0;
            height: 100%;
            background: #4885FC;
            position: absolute;
            bottom: 0px;
            left: 0px;
            border-radius: 4px;
            animation: progress 5s linear;
        }

        @keyframes Incircle {
            0% {
                transform: rotate(0)
            }

            25% {
                transform: rotate(90deg)
            }

            50% {
                transform: rotate(180deg)
            }

            75% {
                transform: rotate(270deg)
            }

            100% {
                transform: rotate(360deg)
            }
        }
    </style>
    <link href="./css/app.css" rel="preload" as="style">
    <link href="./js/app.js" rel="preload" as="script">
    <link href="./js/chunk-vendors.js" rel="preload" as="script">
    <link href="./css/app.css" rel="stylesheet">
</head>

<body>
    <div id="preloading">
        <figure class="main">
            <img class="bg" src="resource/images/loading/bj.png" alt="" srcset="">
            <img class="logo" src="resource/images/loading/logo.png" alt="">
        </figure>
        <div id="msgCover" class="msgCover">
            <!-- 网络环境配置中 -->
        </div>
        <div class="progress">
            <div id="progress" class="item"></div>
        </div>
    </div>
    <div id="box" style="margin: auto;width: 100%;height: 100%;" class="egret-player"
            data-entry-class="Main"
            data-orientation="auto"
            data-scale-mode="showAll"
            data-frame-rate="30"
            data-content-width="1024"
            data-content-height="768"
            data-show-paint-rect="false"
            data-multi-fingered="2"
            data-show-fps="false" data-show-log="false"
            data-show-fps-style="x:0,y:0,size:12,textColor:0xffffff,fontFamily:'Muli',bgAlpha:0.9">
    </div>
    <div id="egretDomRoot" style="position: absolute; border: 0px; left: 0px; top: 0px; transform-origin: 0% 0% 0px; transform: rotate(0deg) scale(1, 1);"></div>
    <div id="lottie" 
        style="position: absolute; z-index: 100; border: 0px; left: 0px; top: 0px;width: 100%;height: 100%;display: none;"
    ></div>
    <!-- <div class="btnBox">
        <button class="preBtn" onclick="PageMgr.prevPage()">上一页</button>
        <button class="nextBtn" onclick="PageMgr.nextPage()">下一页</button>
    </div> -->
    <script src="./js/msgCover/msgCover.js"></script>
    <script src="./js/log/loghub-tracking.js"></script>
    <script>
        // 捕获全局错误并暴露给classroom
        var uuabc;
        var callbackSendError;

        window.addEventListener('error', function (e) {
            var str = 'message: ' + e.message + '; ' +
                'filename: ' + e.filename + '; ' +
                'lineno: ' + e.lineno + '; ' +
                'colno: ' + e.colno + '; ' +
                'error: ' + e.error + '.'
            Logger('windowOnError', '', str)
        }, true);
    </script>
    <script>
        
        (function () {
            Logger('index.html', '课件加载', '开始')
            var msgCoverDom = document.getElementById('msgCover')

            init();

            function init() {
                Logger('index.html', '设置鼠标右键以及domain', '开始')

                //设置鼠标右键
                document.oncontextmenu = function () {
                    return false;
                }
                //跨域设置
                document.domain = getCurrentDomain(document.location.hostname);
                Logger('index.html', '设置鼠标右键以及domain', '完成')
                // document.domain = 'localhost';
            }

            function getCurrentDomain(host) {
                var occurrences = host.split('.');
                var domain = '';

                if (occurrences.length === 1) {
                    domain = occurrences.join('.');
                } else if (occurrences.length === 2) {
                    domain = occurrences.join('.');
                } else {
                    domain = occurrences.splice(occurrences.length - 2).join('.');
                }
                // console.log(domain);
                return domain;
            }

            // 获取data文件下数据
            function getData(path) {
                return new Promise(function(resolve, reject)  {
                    var xhrJsonData = new XMLHttpRequest();
                    xhrJsonData.open('GET',  path + Math.random(), true);
                    xhrJsonData.addEventListener('load', function () {
                        var respone = JSON.parse(xhrJsonData.response);
                        resolve(respone)
                    });
                    xhrJsonData.send(null);
                })
            }
            Logger('index.html', '获取jsonData文件', '开始')
            ShowLoadMsg(msgCoverDom, MsgCover('jsonData'))

            getData('./data/jsonData.json?v=').then(function(res) {
                ShowLoadMsg(msgCoverDom, MsgCover('jsonDataEnd'))
                if (res) {
                    window.previewData = res;
                    Logger('index.html', '获取jsonData文件', '完成')

                    ShowLoadMsg(msgCoverDom, MsgCover('manifest'))
                    Logger('index.html', '获取manifest文件', '开始')
                    getData('./data/manifest.json?v=').then(function(manifest) {
                        var list = manifest.initial.concat(manifest.game);
                        ShowLoadMsg(msgCoverDom, MsgCover('manifestEnd'))
                        Logger('index.html', '获取manifest文件', '完成')
                        Logger('index.html', '加载manifest包含的js', '开始')
                        loadScript(list, function () {
                            ShowLoadMsg(msgCoverDom, MsgCover('jsEnd'))
                            Logger('index.html', '加载manifest包含的js', '结束')
                            Logger('index.html', 'startRunEgret')
                            startRunEgret();
                            if('UCPlugin' in window){
                                UCPlugin.prototype.loadScript = loadSingleScript;
                                window.ucPlugin = new UCPlugin();
                            }
                        });
                    })
                }
            })


            var loadScript = function (list, callback) {
                var loaded = 0;
                var loadNext = function () {
                    ShowLoadMsg(msgCoverDom, MsgCover('js') + (loaded + 1) + '/' + list.length)
                    loadSingleScript(list[loaded], function () {
                        loaded++;
                        if (loaded >= list.length) {
                            callback();
                        } else {
                            loadNext();
                        }
                    })
                };
                loadNext();
            };
            var loadSingleScript = function (src, callback) {
                var s = document.createElement('script');
                s.async = false;
                s.src = src;
                s.addEventListener('load', function () {
                    s.parentNode.removeChild(s);
                    s.removeEventListener('load', arguments.callee, false);
                    callback();
                }, false);
                document.body.appendChild(s);
            };
            
            function runEgret() {
                /**
                 * {
                 * "renderMode":, //Engine rendering mode, "canvas" or "webgl"
                 * "audioType": 0 //Use the audio type, 0: default, 2: web audio, 3: audio
                 * "antialias": //Whether the anti-aliasing is enabled in WebGL mode, true: on, false: off, defaults to false
                 * "calculateCanvasScaleFactor": //a function return canvas scale factor
                 * }
                 **/
                egret.runEgret({
                    renderMode: "webgl",
                    audioType: 0,
                    calculateCanvasScaleFactor: function (context) {
                        var backingStore = context.backingStorePixelRatio ||
                            context.webkitBackingStorePixelRatio ||
                            context.mozBackingStorePixelRatio ||
                            context.msBackingStorePixelRatio ||
                            context.oBackingStorePixelRatio ||
                            context.backingStorePixelRatio || 1;
                        return (window.devicePixelRatio || 1) / backingStore;
                    }
                });
            }

            function startRunEgret() {
                runEgret();
            }

        })();

        var PageMgr;

        function loadingBegin() {
            document.getElementById("preloading").style.display = "none";
        }

        function GoProgress(current, total) {
            var progress = document.getElementById('progress');
            const parentWidth = progress.parentElement.clientWidth;
            // console.log('width', parentWidth);
            progress.style.width = (current / total * parentWidth) + 'px';
        }
    </script>
    <div id="app"></div>
    <script src="./js/chunk-vendors.js"> </script> 
    <script src="./js/app.js"> </script> 
</body> 
</html>