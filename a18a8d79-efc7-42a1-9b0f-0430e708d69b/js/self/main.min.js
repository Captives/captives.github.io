var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(o,r){function s(t){try{h(n.next(t))}catch(e){r(e)}}function a(t){try{h(n["throw"](t))}catch(e){r(e)}}function h(t){t.done?o(t.value):new i(function(e){e(t.value)}).then(s,a)}h((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(o)throw new TypeError("Generator is already executing.");for(;h;)try{if(o=1,r&&(s=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,r=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){h.label=i[1];break}if(6===i[0]&&h.label<s[1]){h.label=s[1],s=i;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(i);break}s[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(n){i=[6,n],r=0}finally{o=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var o,r,s,a,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},Matrix=function(){function t(t,e,i,n,o,r){this.a=t||1,this.b=e||0,this.c=i||0,this.d=n||1,this.x=o||0,this.y=r||0}return t.prototype.equals=function(t){return this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d&&this.x===t.x&&this.y===t.y?!0:!1},t.prototype.identity=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.x=0,this.y=0},t.prototype.clone=function(){return new t(this.a,this.b,this.c,this.d,this.x,this.y)},t.prototype.copyFrom=function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.x=t.x,this.y=t.y},t.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a;this.a=e*this.a-i*this.b,this.b=i*n+e*this.b,n=this.c,this.c=e*this.c-i*this.d,this.d=i*n+e*this.d,n=this.x,this.x=e*this.x-i*this.y,this.y=i*n+e*this.y},t.prototype.translate=function(t,e){this.x+=t,this.y+=e},t.prototype.concat=function(t){var e=this.a*t.a,i=0,n=0,o=this.d*t.d,r=this.x*t.a+t.x,s=this.y*t.d+t.y;(0!==this.b||0!==this.c||0!==t.b||0!==t.c)&&(e+=this.b*t.c,o+=this.c*t.b,i+=this.a*t.b+this.b*t.d,n+=this.c*t.a+this.d*t.c,r+=this.y*t.c,s+=this.x*t.b),this.a=e,this.b=i,this.c=n,this.d=o,this.x=r,this.y=s},t.prototype.invert=function(){if(0===this.b&&0===this.c&&0!==this.a&&0!==this.d)this.a=1/this.a,this.d=1/this.d,this.b=0,this.c=0,this.x=-this.a*this.x,this.y=-this.d*this.y;else{var t=this.a*this.d-this.b*this.c;if(0===t)return void this.identity();t=1/t;var e=this.a;this.a=this.d*t,this.b=-this.b*t,this.c=-this.c*t,this.d=e*t,e=this.y,this.y=-(this.b*this.x+this.d*this.y),this.x=-(this.a*this.x+this.c*e)}},t.prototype.getRotationX=function(){return Math.atan2(this.b,this.a)},t.prototype.getRotationY=function(){return Math.atan2(this.c,this.d)},t.prototype.getTransformedX=function(t,e){return this.x+this.a*t+this.c*e},t.prototype.getTransformedY=function(t,e){return this.y+this.d*e+this.b*t},t.prototype.scale=function(t,e){this.a*=t,this.b*=e,this.c*=t,this.d*=e,this.x*=t,this.y*=e},t.prototype.containsPoint=function(e,i,n,o){var r=t.temp;r.copyFrom(this),r.invert();var s=r.x+r.a*e+r.c*i,a=r.y+r.d*i+r.b*e;return s>=0&&n>=s&&a>=0&&o>=a?!0:!1},t.temp=new t,t}(),Mouse=function(){function t(){throw new Error("can not create a instance")}return t.get=function(e,i){i||(i=e.currentTarget);var n=i.globalToLocal(e.stageX,e.stageY);return t.x=n.x,t.y=n.y,t},t.x=0,t.y=0,t.START="touchBegin",t.MOVE="touchMove",t.END="touchEnd",t.TAP="touchTap",t}(),isClose=!1,LogColor;!function(t){t.title="color: black;font-weight: 600; font-size: 20px;",t.info="font-weight: bold",t.warn="color: yellow;font-weight: 600;",t.erro="color: red;font-weight: 600;",t.str="background: rgba(100, 100, 219, .3); padding: 1px 5px; border: 1px solid rgba(0, 0, 0, 0.1)",t.obj="background: skyblue; padding: 1px 5px; border: 1px solid rgba(0, 0, 0, 0.1)"}(LogColor||(LogColor={}));var LogType;!function(t){t.title="title",t.info="info",t.warn="warn",t.erro="erro",t.str="str",t.obj="obj"}(LogType||(LogType={}));var MyConsole=function(){function t(){}return t.info=function(t,e,i){if(void 0===t&&(t=""),void 0===e&&(e=LogType.str),void 0===i&&(i=isClose),!i){var n=[];if("string"==typeof t){var o="obj"===e?"%c/*** "+t+" ***/":"%c"+t;n=[o,LogColor[e]]}else n=[t]}},t}(),ObserverNew=function(){function t(){this.subscribers=[]}return t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.register=function(t,e,i){var n={aimTarget:t,animateType:e,callback:i};this.subscribers.push(n)},t.prototype.emit=function(t,e){for(var i=0,n=this.subscribers.length;n>i;i++){var o=this.subscribers[i];if(o.aimTarget===t&&o.animateType===e)return void(o.callback&&o.callback instanceof Function&&o.callback())}},t.prototype.remove=function(t,e){for(var i=0,n=this.subscribers.length;n>i;i++){var o=this.subscribers[i];if(o.aimTarget===t&&o.animateType===e)return void this.subscribers.splice(i,1)}},t.prototype.clear=function(){this.subscribers.length=0},t.instance=null,t}(),Picture=function(){function t(t,e){this.image=t;var i=new Matrix(e.a,e.b,e.c,e.d,e.x,e.y);this.transform=new Transformable(t.width,t.height,i,this)}return t.prototype.draw=function(t){var e=this.transform.matrix;this.image.matrix=new egret.Matrix(e.a,e.b,e.c,e.d,e.x,e.y),t.addChild(this.image)},t.prototype.undraw=function(t){t.removeChild(this.image)},t}(),Pseudorandom=function(){function t(t){if(this.initArr=[],this.hasSelectedItem=[],"number"==typeof t){for(var e=[],i=0,n=t;n>i;i++)e.push(i);this.initArr=e}else this.initArr=t}return t.prototype.getIndex=function(){var t=this,e=this.initArr.filter(function(e){return!t.hasSelectedItem.includes(e)}),i=e.length;0===i&&(this.hasSelectedItem=[],e=this.initArr.slice(),i=e.length);var n=Math.floor(Math.random()*i),o=e[n];return this.hasSelectedItem.push(o),o},t}(),Transformable=function(){function t(t,e,i,n){this.width=0,this.height=0,this.width=t,this.height=e,this.matrix=i,this.owner=n}return t}(),UUType;!function(t){t[t.TEXT=1]="TEXT",t[t.IMAGE=2]="IMAGE",t[t.AUDIO=3]="AUDIO",t[t.AudioSmall=302]="AudioSmall",t[t.VIDEO=4]="VIDEO",t[t.BACKGROUND=99]="BACKGROUND",t[t.CIRCLE_SECTOR=101]="CIRCLE_SECTOR",t[t.CARDALERT=1001]="CARDALERT",t[t.CARDALERT_SW=1002]="CARDALERT_SW",t[t.SLIDESHOW=1101]="SLIDESHOW",t[t.MARQUEE_NORMAL=1201]="MARQUEE_NORMAL",t[t.MARQUEE_STUDENT=1202]="MARQUEE_STUDENT",t[t.DICE=1301]="DICE",t[t.MATCH=1401]="MATCH",t[t.DROPOUT=1501]="DROPOUT",t[t.CLASSIFY=1601]="CLASSIFY",t[t.DRAWIMAGE=1801]="DRAWIMAGE",t[t.DRAWMAINIMAGE=1802]="DRAWMAINIMAGE",t[t.DRAWDISTINATIONMAINIMAGE=1803]="DRAWDISTINATIONMAINIMAGE",t[t.INVITEALL=2001]="INVITEALL",t[t.BTNSTART=3001]="BTNSTART",t[t.StarFlicker=4001]="StarFlicker",t[t.BTNTIPS=5001]="BTNTIPS",t[t.BTNRESET=5002]="BTNRESET",t[t.BTNANSWER=5003]="BTNANSWER",t[t.TEACHINGIMG=5011]="TEACHINGIMG",t[t.INVITETEACHER=5021]="INVITETEACHER",t[t.SINGLE_CHOICE=6001]="SINGLE_CHOICE",t[t.BTNANSWERSTART=7001]="BTNANSWERSTART",t[t.ANSWER_QUESTION=7002]="ANSWER_QUESTION",t[t.JUDGE_QUESTION=6003]="JUDGE_QUESTION",t[t.MULTI_QUESTION=6004]="MULTI_QUESTION"}(UUType||(UUType={}));var IsNotEgretUUType=[UUType.ANSWER_QUESTION],LayerSet=function(){function t(){throw new Error("can not create a instance")}return t.createInstance=function(t,e){var i=new t(e);return i},t.getLayer=function(t,e){return t.filter(function(t){return t.uuType===e})},t.getIsNotEgretUUType=function(){return this.IsNotEgretUUType},t.IsNotEgretUUType=IsNotEgretUUType,t}(),TypeMapName=function(){function t(){}return t.getNameByType=function(t){return this.config[t]},t.config={1:"UULabel",2:"UUImage",3:"UUAudio",302:"AudioSmall",4:"UUVideo",99:"UUBackground",101:"CircleSector",1001:"CardAlert",1002:"CardAlertSwitch",1101:"Slideshow",1201:"MarqueeNormal",1202:"MarqueeStudent",1301:"Dice",1401:"Match",1501:"DropOut",1601:"Classify",1801:"DrawImage",2001:"InviteAll",3001:"BtnStart",4001:"StarFlicker",5001:"BtnTips",5002:"BtnReset",5003:"BtnAnswer",5011:"TeachingImg",5021:"InviteTeacher",6001:"SingleChioce",7001:"BtnAnswerStart",7002:"AnswerQuestion",6003:"JudgeQuestion",6004:"MultiQuestion",1803:"DrawDistinationImage",1802:"DrawMainImage"},t}(),TipsContainer=function(t){function e(e){var i=t.call(this)||this;i.content="",i.templateResources={bgUrl:"",soundClose:""},i.width=1024,i.height=240,i.bgUrl="",i.soundClose="",i.labelWidth=874,i.labelHeight=190,i.btnClose="common_template#close1",MyConsole.info("TipsContainer Instance");var n=e.templateResources,o=n.bgUrl,r=n.soundClose;return i.bgUrl=o,i.soundClose=r,i.soundCloseCom=new UUSoundCom(i.soundClose),i.content=e.content,i.touchEnabled=!1,i.init(),i}return __extends(e,t),e.prototype.draw=function(t){this.soundCloseCom.play(),t.addChild(this)},e.prototype.closePanel=function(){this.soundCloseCom.play(),this.$parent.removeChild(this)},e.prototype.show=function(){this.soundCloseCom.play()},e.prototype.init=function(){var t=UIFactory.createImage(this.bgUrl,this.width,this.height),e=UIFactory.createImage(this.btnClose,50,50);e.right=25,e.top=25,e.touchEnabled=!0,e.addEventListener(Mouse.START,this.closePanel,this);var i=this.createContent();this.addChild(t),this.addChild(i),this.addChild(e)},e.prototype.createContent=function(){var t=UIFactory.createGroup(this.labelWidth,this.labelHeight);t.y=25,t.x=50,MyConsole.info("content = "+this.content);var e=this.createLabel(this.content);return t.addChild(e),t},e.prototype.createLabel=function(t){var e=new eui.Label;return e.fontFamily="Muli",e.width=this.labelWidth,e.height=this.labelHeight,e.size=30,e.textColor=0,e.lineSpacing=2,e.text=t,e},e}(eui.Group),UUButton=function(t){function e(e){var i=t.call(this)||this;return i.width=100,i.height=49,i.source=RES.getRes(e),i}return __extends(e,t),e}(eui.Image),UUSound=function(t){function e(e,i){var n=t.call(this)||this;return n.isLoaded=!1,n._pauseTime=0,MyConsole.info("UUSound Instance"),n._sound=document.createElement("audio"),n._sound.controls=!1,n._sound.src=e,n.mediaSrc=e,n._sound.addEventListener("loadedmetadata",function(){n.isLoaded=!0,n.initUI()},!1),n._sound.addEventListener("ended",function(){n.onComplete()},!1),i?n.id=i:n.id=(new Date).getTime(),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n}return __extends(e,t),e.prototype.callBack=function(t,e){if(window.GlobalData.isMute){var i=window.location.href,n=i.split("index.html"),o=this.mediaSrc;o=o.indexOf("http")>=0?o:o.indexOf("resource/")>=0?n[0]+o:window.GlobalData.origin+o,ClassrommMgr.callbackInSoundPlay({id:this.id,time:e||0,url:o,status:t})}},e.prototype.play=function(t){void 0===t&&(t=1),this._sound&&(-1===t?this._sound.loop=!0:this._sound.loop=!1,window.GlobalData.isMute?this._sound.muted=!0:this._sound.muted=!1,this._sound.currentTime=this._pauseTime,this._sound.play(),this.callBack(1,this._pauseTime))},e.prototype.pause=function(){this._sound&&(this._pauseTime=this._sound.currentTime,this.stop())},e.prototype.stop=function(){this._sound&&(this._sound.pause(),this.callBack(2,this._pauseTime))},e.prototype.replay=function(){this._sound&&(this._pauseTime=0,this.stop(),this.play())},e.prototype.onRemoveFromStage=function(){MyConsole.info("UUSound onRemoveFromStage."),this.onComplete()},e.prototype.onComplete=function(){this._pauseTime=0,this.stop()},e}(eui.Group),UUSoundCom=function(t){function e(e,i){var n=t.call(this)||this;return n.isLoaded=!1,n._pauseTime=0,MyConsole.info("UUSoundCom Instance"),n.mediaSrc=e,i?n.id=i:n.id=(new Date).getTime(),n.touchEnabled=!1,n.loadSound(),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemoveFromStage,n),n}return __extends(e,t),e.prototype.play=function(t){void 0===t&&(t=1),this.isLoaded&&(window.GlobalData.isMute?(this._channel=this._sound.play(this._pauseTime,t),this._channel.volume=0,MyConsole.info("this._channel.volume"+this._channel.volume)):(this._channel=this._sound.play(this._pauseTime,t),this._channel.volume=1),this._channel.addEventListener(egret.Event.SOUND_COMPLETE,this.onComplete,this),this.callBack(1,this._pauseTime))},e.prototype.callBack=function(t,e){if(window.GlobalData.isMute){var i=window.location.href,n=i.split("index.html"),o=this.mediaSrc;o=o.indexOf("http")>=0?o:o.indexOf("resource/")>=0?n[0]+o:window.GlobalData.origin+o,ClassrommMgr.callbackInSoundPlay({id:this.id,url:o,time:e||0,status:t})}},e.prototype.pause=function(){this.isLoaded&&this._channel&&(this._pauseTime=this._channel.position,this.stop(),this.callBack(2,this._pauseTime))},e.prototype.stop=function(){this.isLoaded&&this._channel&&(this._channel.removeEventListener(egret.Event.SOUND_COMPLETE,this.onComplete,this),this._channel.stop(),this._channel=null,this.callBack(2,this._pauseTime))},e.prototype.replay=function(){this.isLoaded&&this._channel&&(this._pauseTime=0,this.stop(),this.play())},e.prototype.onAddToStage=function(t){},e.prototype.onRemoveFromStage=function(t){MyConsole.info("UUSoundCom onRemoveFromStage."),this.stop()},e.prototype.loadSound=function(){var t=this,e=this._sound=new egret.Sound;e.addEventListener(egret.Event.COMPLETE,function(e){t.isLoaded=!0},this),e.load(this.mediaSrc)},e.prototype.onComplete=function(t){},e}(eui.Group),WebVideo=function(){function t(t,e,i,n){var o=this;this.isClear=!1,this.isCanPlay=!1,this.id=t,this.videoWidth=e,this.videoHeight=i,this.matrix=n;var r=document.getElementById("egretDomRoot");this.boxDiv=this.createBoxDom(),this.video=this.createVideoComponent(),window.GlobalData.isMute?this.video.muted=!0:this.video.muted=!1,this.mask=this.createMask(),this.boxDiv.appendChild(this.video),this.boxDiv.appendChild(this.mask),this.changeEgretDomRootPosition(),r&&r.appendChild(this.boxDiv),this.onScreenChange(),"unknown"!==this.getMobileOperatingSystem()?this.boxDiv.addEventListener("click",function(){clearTimeout(o.timer),o.mask.classList.contains("display")?o.mask.classList.remove("display"):(o.mask.classList.add("display"),o.timer=setTimeout(function(){o.mask.classList.remove("display")},5e3))},!1):this.boxDiv.classList.add("isPc")}return Object.defineProperty(t.prototype,"currentTime",{get:function(){var t=window.currentTime||0;try{if(!sessionStorage.getItem(this.id.toString()))return 0;var e=sessionStorage.getItem(this.id.toString());t=JSON.parse(e).currentTime}catch(i){Logger("WebVideo","sessionStorage err",i)}return t},set:function(t){var e={currentTime:t};try{sessionStorage.setItem(this.id.toString(),JSON.stringify(e))}catch(i){window.currentTime=t,Logger("WebVideo","sessionStorage err",i)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"src",{get:function(){return this._src},set:function(t){this._src=t,this.video.src=t},enumerable:!0,configurable:!0}),t.prototype.callBack=function(t,e){if(window.GlobalData.isMute){var i=window.location.href,n=i.split("index.html"),o=this.src;o=o.indexOf("http")>=0?o:o.indexOf("resource/")>=0?n[0]+o:window.GlobalData.origin+o,ClassrommMgr.callbackInSoundPlay({id:this.id,url:o,time:e||0,status:t})}},t.prototype.play=function(){this.video.removeEventListener("timeupdate",this.currentTimeListener),this.video.addEventListener("timeupdate",this.currentTimeListener),this.video.currentTime=this.currentTime,this.video.play(),this.boxDiv.classList.add("isPlaying"),this.callBack(1,this.currentTime)},t.prototype.pause=function(){this.currentTime=this.video.currentTime,this.video.pause(),this.boxDiv.classList.remove("isPlaying"),this.callBack(2,this.currentTime)},t.prototype.stop=function(){this.video.pause(),this.video.removeEventListener("timeupdate",this.currentTimeListener),this.currentTime=0,this.boxDiv.classList.remove("isPlaying"),this.callBack(2,this.currentTime)},t.prototype.setEnded=function(t,e){var i=this;this.video.addEventListener("ended",function(){t(e),i.boxDiv.classList.remove("isPlaying")},!0)},t.prototype.setCanPlay=function(t,e){var i=this;this.video.addEventListener("loadedmetadata",function(){i.isCanPlay=!0,i.video.removeEventListener("loadedmetadata",arguments.callee,!0),t(e)},!0)},t.prototype.canPlay=function(){return this.isCanPlay},t.prototype.setPoster=function(t){this.video.poster=t},t.prototype.clear=function(){this.stop(),this.video&&this.video.removeEventListener("timeupdate",this.currentTimeListener);try{sessionStorage.clear()}catch(t){Logger("WebVideo","sessionStorage err",t)}var e=document.getElementById("egretDomRoot");e&&e.removeChild(e.firstElementChild),this.isClear=!0},t.prototype.reload=function(){this.video&&this.video.load()},t.prototype.createBoxDom=function(){var t=document.createElement("div");return t.setAttribute("id","videoComponentBox"),this.changeSize(t),t},t.prototype.createVideoComponent=function(){var t=this,e=document.createElement("video");return e.setAttribute("id","videoComponent"),e.setAttribute("playsinline","true"),e.controls=!1,this.currentTimeListener=function(e){t.currentTime=e.target.currentTime},e.addEventListener("timeupdate",this.currentTimeListener,!1),e},t.prototype.createMask=function(){var t=document.createElement("div");t.setAttribute("id","videoComponentMask");var e=this.createBtnContainer();return t.appendChild(e),t},t.prototype.createBtnContainer=function(){var t=document.createElement("div");t.setAttribute("id","btnContainer");var e=this.createBtn("iconfont icon-play2");e.classList.add("playBtn"),e.addEventListener("click",this.playMsg.bind(this),!1);var i=this.createBtn("iconfont icon-pause");i.classList.add("pauseBtn"),i.addEventListener("click",this.stopMsg.bind(this),!1);var n=this.createBtn("iconfont icon-spinner11");return n.classList.add("stopBtn"),n.addEventListener("click",this.refreshMsg.bind(this),!1),t.appendChild(e),t.appendChild(i),t.appendChild(n),t},t.prototype.createBtn=function(t){var e=document.createElement("span");return e.setAttribute("class",t),e},t.prototype.changeSize=function(t){var e=document.querySelector("canvas"),i=e.offsetWidth/1024,n=this.videoWidth,o=this.videoHeight,r=this.matrix,s=r.a,a=r.b,h=r.c,d=r.d,c=r.x,u=r.y;n*=i,o*=i,c*=i,u*=i;var l=null;n*s>=e.offsetWidth||o*a>=e.offsetHeight?(l="matrix(1, "+a+", "+h+", 1, 0, 0)",n=e.offsetWidth,o=e.offsetHeight):l="matrix("+s+", "+a+", "+h+", "+d+", "+c+", "+u+")",t.setAttribute("style","\n        position: absolute;\n        border: 0px;\n        left: 0px;\n        top: 0px;\n        transform-origin: 0% 0% 0px;\n        transform: "+l+";\n        width: "+n+"px;\n        height: "+o+"px;")},t.prototype.changeEgretDomRootPosition=function(){var t=document.getElementById("egretDomRoot"),e=document.querySelector("canvas");t&&(t.style.left=e.style.left,t.style.top=e.style.top)},t.prototype.screenChangeFn=function(){this.isClear||this.boxDiv&&(this.changeSize(this.boxDiv),this.changeEgretDomRootPosition())},t.prototype.onScreenChange=function(){var t=this,e=new MutationObserver(function(e,i){e.forEach(function(e){t.screenChangeFn()})}),i={attributes:!0,attributeOldValue:!0,attributeFilter:["style"]},n=document.querySelector("canvas");e.observe(n,i)},t.prototype.playMsg=function(){var t={cmd:1001,type:5,id:this.id};PageMgr.sendMsg(JSON.stringify(t))},t.prototype.stopMsg=function(){var t={cmd:1002,type:5,id:this.id};PageMgr.sendMsg(JSON.stringify(t))},t.prototype.refreshMsg=function(){var t={cmd:99,type:5,id:this.id};PageMgr.sendMsg(JSON.stringify(t))},t.prototype.getMobileOperatingSystem=function(){var t=navigator.userAgent||navigator.vendor;return/windows phone/i.test(t)?"Windows Phone":/android/i.test(t)?"Android":/iPad|iPhone|iPod/.test(t)?"iOS":"unknown"},t}(),FilterFactory=function(){function t(){}return t.createGlodFilter=function(){var t=16766720,e=.8,i=60,n=60,o=2,r=10,s=!1,a=!1,h=new egret.GlowFilter(t,e,i,n,o,r,s,a);return h},t.createGlodFilterForText=function(){var t=16766720,e=.8,i=20,n=20,o=5,r=egret.BitmapFilterQuality.HIGH,s=!1,a=!1,h=new egret.GlowFilter(t,e,i,n,o,r,s,a);return h},t.createShadowFilter=function(){var t=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0],e=new egret.ColorMatrixFilter(t);return e},t}(),UIFactory=function(){function t(){}return t.createGroup=function(t,e){var i=new eui.Group;return t&&(i.width=t),e&&(i.height=e),i},t.createLabel=function(t,e,i){void 0===e&&(e=0);var n=new eui.Label;return n.text=t,n.textColor=e,i&&(n.size=i),n},t.createImage=function(t,e,i){var n=new eui.Image;return n.source=t,e&&(n.width=e),i&&(n.height=i),n},t.createHLayout=function(t,e,i){void 0===t&&(t=10),void 0===e&&(e=egret.HorizontalAlign.LEFT),void 0===i&&(i=egret.VerticalAlign.TOP);var n=new eui.HorizontalLayout;return n.gap=t,n.horizontalAlign=e,n.verticalAlign=i,n},t.createVLayout=function(t,e,i){void 0===t&&(t=10),void 0===e&&(e=egret.HorizontalAlign.LEFT),void 0===i&&(i=egret.VerticalAlign.TOP);var n=new eui.VerticalLayout;return n.gap=t,n.horizontalAlign=e,n.verticalAlign=i,n},t.createTLayout=function(t,e,i){void 0===t&&(t=1),void 0===e&&(e=10),void 0===i&&(i=10);var n=new eui.TileLayout;return n.requestedColumnCount=t,n.horizontalGap=e,n.verticalGap=i,n},t.createLayoutByNum=function(t,e,i){void 0===i&&(i="h");var n;return n=t>=e?"h"===i?this.createHLayout():this.createVLayout():this.createTLayout(t)},t}(),AliLog=function(){function t(t,e,i){this.uri="//"+e+"."+t+"/logstores/"+i+"/track?APIVersion=0.6.0",this.params=new Array,this.httpRequest=this.createHttpRequest()}return t.instance=function(){return this._instance||(this._instance=new t(this.host,this.project,this.project)),this._instance},t.Logger=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!this.openAlilog){for(var i=[],n=0,o=t.length;o>n;n++){var r=t[n];r instanceof Array&&i.push(r.join(" ")),r instanceof Object&&i.push(JSON.stringify(r))}this.debug,this.instance(),this._instance.push(this.uuid,window.GlobalData.user.id+" 'courseware' "+t.join(" ")),this._instance.logger()}},t.prototype.createHttpRequest=function(){return window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest?new XMLHttpRequest:void 0},t.prototype.push=function(t,e){t&&e&&(this.params.push(t),this.params.push(e))},t.prototype.logger=function(){for(var t=this.uri,e=0;this.params.length>0;)t+=e%2===0?"&"+encodeURIComponent(this.params.shift()):"="+encodeURIComponent(this.params.shift()),++e;try{this.httpRequest.open("GET",t,!0),this.httpRequest.send(null)}catch(i){window&&window.console&&"function"==typeof window.console.log}},t.openAlilog=!1,t.uuid="",t.debug=!0,t.host="cn-hangzhou.log.aliyuncs.com",t.project="prd-frontend-log",t.logstore="prd-frontend-log",t}(),AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var o=RES.getRes(t);o?n(o):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}(),DirectionFilter=function(){function t(e){return this.isFirstTimeOut=!0,this.directionList=[],this.time=0,t._instance||(this.directionCallback=e,t._instance=this),t._instance}return t.prototype.pushDirection=function(t){var e=this;this.directionList.push(t),this.isFirstTimeOut&&(this.isFirstTimeOut=!1,setTimeout(function(){for(var t=[],i=0,n=e.directionList.length;n>i;i++){var o=e.directionList[i],r=t.indexOf(o);-1!==r&&t.splice(r,1),t.push(o)}e.directionList=t;for(var s=[],i=e.directionList.length-1;i>=0;i--){var o=JSON.parse(e.directionList[i]),a=o.id,h=o.type,d=o.isSingle;3===h&&d&&(s.map(function(t){return t.id}).includes(a)?e.directionList.splice(i,1):s.push(o))}try{e.directionList.forEach(function(t){e.emitDirection(t)})}catch(c){}e.directionList.length=0,e.isFirstTimeOut=!0},this.time))},t.prototype.emitDirection=function(t){this.directionCallback&&this.directionCallback(t)},t}(),LoadingUI=function(t){function e(e){var i=t.call(this)||this;return i.width=1024,i.height=768,i.logoWidth=500,i.logoHeight=400,i.bj2Width=800,i.bj2Height=800,i.barWidth=400,i.barHeight=10,i.barMask="",i.type="display",e&&(i.type=e),i.createView(),i}return __extends(e,t),e.prototype.onProgress=function(t,e){if("display"===this.type)GoProgress(t,e);else{var i=t/e*this.barWidth;this.barMask.mask=new egret.Rectangle(0,0,i,this.barHeight)}},e.prototype.createView=function(){if("display"!==this.type){var t=this.createBj(),e=this.createBj2(),i=this.createBj3(),n=this.createLogo(),o=this.createBar();e.anchorOffsetX=this.bj2Width/2,e.anchorOffsetY=this.bj2Height/2,e.x=this.bj2Width/2+112,e.y=this.bj2Height/2,i.x=112,i.y=this.bj2Height/2,n.x=240,n.y=160,o.x=312,o.y=650,this.addChild(t),this.addChild(e),this.addChild(i),this.addChild(n),this.addChild(o),this.createAnimation(e)}},e.prototype.createAnimation=function(t){egret.Tween.get(t,{loop:!0}).to({rotation:360},8e3)},e.prototype.createBj=function(){var t=new egret.Shape;return t.graphics.beginFill(16766849,1),t.graphics.drawRect(0,0,this.width,this.height),t.graphics.endFill(),t},e.prototype.createBj2=function(){return UIFactory.createImage("resource/images/loading/bj.png",this.bj2Width,this.bj2Height)},e.prototype.createBj3=function(){var t=new egret.Shape;return t.graphics.beginFill(16766849,1),t.graphics.drawRect(0,0,this.bj2Width,this.bj2Height/2),t.graphics.endFill(),t},e.prototype.createLogo=function(){return UIFactory.createImage("resource/images/loading/logo.png",this.logoWidth,this.logoHeight)},e.prototype.createBar=function(){var t=new eui.Group;t.width=this.barWidth,t.height=this.barHeight;var e=this.createBarMask();e.x=0,e.y=0,e.mask=new egret.Rectangle(0,0,10,this.barHeight),this.barMask=e;var i=this.createBarBj();return t.addChild(i),t.addChild(e),t},e.prototype.createBarMask=function(){var t=new eui.Rect;return t.width=this.barWidth,t.height=this.barHeight,t.ellipseHeight=10,t.ellipseWidth=15,t.fillColor=4752892,t},e.prototype.createBarBj=function(){var t=new eui.Rect;return t.width=this.barWidth,t.height=this.barHeight,t.ellipseHeight=10,t.ellipseWidth=15,t.fillColor=15381096,t},e}(eui.Group),Lottie=function(){function t(){}return t.show=function(t,e){var i=this.typeSwichName[t],n=this.pathBaseUrl+i+".json";this.display(n,e)},t.showTryAgain=function(){var t=this.pathBaseUrl+"TryAgain.json";this.display(t)},t.hidden=function(t){this.animation&&this.animation.destroy(),t&&t(),this.hiddenContainer()},t.hiddenAll=function(){lottie&&lottie.destroy(),this.hiddenContainer()},t.display=function(t,e){var i=this;if(this.getContainer(),this.container){this.showContainer();try{var n=lottie.loadAnimation({container:this.container,renderer:"canvas",loop:!1,autoplay:!0,path:t});n.addEventListener("complete",function(){i.hidden(e)},!1),this.animation=n}catch(o){}}},t.getContainer=function(){this.container||(this.container=document.getElementById("lottie"))},t.showContainer=function(){this.container&&(this.container.style.display="block")},t.hiddenContainer=function(){this.container&&(this.container.style.display="none")},t.pathBaseUrl="resource/lottie/",t.typeSwichName={6001:"AnswerRight",6003:"AnswerRight",6004:"AnswerRight",7002:"AnswerRight",1802:"AnswerRight",ranking:"Ranking"},t}(),MsgFilters=function(){function t(t){var e=t.currentMsg,i=t.newMsg;return this.currentMsg=e,this.newMsg=i,this.pushMsg()}return t.prototype.pushMsg=function(){var t=JSON.parse(JSON.stringify(this.currentMsg)),e=JSON.parse(JSON.stringify(this.newMsg)),i=[];Object.keys(t).forEach(function(e){t[e]&&0!==t[e].length&&t[e].forEach(function(t){i.push(t)})});var n=[];Object.keys(e).forEach(function(t){e[t]&&0!==e[t].length&&e[t].forEach(function(t){n.push(t)})}),i=this.getComMsg(n,i);var o={};return i.forEach(function(t){var e=JSON.parse(t).id;o[e]||(o[e]=[]),o[e].push(t)}),o},t.prototype.getComMsg=function(t,e){var i=this;return t.forEach(function(t,n){var o=JSON.parse(t).type;switch(o){case 1:e=[t];break;case 2:e=i.dealType2(t,e);break;case 3:e.push(t);break;case 4:e=e;break;case 5:e=i.dealType5(t,e);break;case 6:e=i.dealType6(t,e);break;case 7:e=i.dealType7(t,e);break;case 8:e=i.dealType8(t,e)}}),e},t.prototype.dealType2=function(t,e){var i=e.filter(function(t){return 2!==JSON.parse(t).type});return i.push(t),i},t.prototype.dealType5=function(t,e){var i=JSON.parse(t).id,n=e.filter(function(t){var e=JSON.parse(t);return 5===e.type&&e.id===i?!1:!0});return n.push(t),n},t.prototype.dealType6=function(t,e){var i=JSON.parse(t),n=i.user,o=i.msg,r=o.id,s=e.filter(function(t){var e=JSON.parse(t);return 6===e.type&&e.msg.id===r&&e.user.id===n.id?!1:!0});return s.push(t),s},t.prototype.dealType7=function(t,e){var i=JSON.parse(t),n=i.cmd,o=i.id,r=e.filter(function(t){var e=JSON.parse(t);return 7===e.type&&e.id===o&&e.cmd===n?!1:!0});return r.push(t),r},t.prototype.dealType8=function(t,e){var i=JSON.parse(t),n=i.cmd,o=i.msg,r=o.id,s=e.filter(function(t){var e=JSON.parse(t);return 8===e.type&&e.msg.id===r&&e.cmd===n?!1:!0});return s.push(t),s},t}(),PageInfo=function(){function t(){return t._instance||(t._instance=this),t._instance}return t.prototype.sendInfo=function(t){var e=t.classroomTipsDis;this.sendClassroomTips(e)},t.prototype.sendClassroomTips=function(t){var e={type:1,msg:t};callbackInSendInfo(JSON.stringify(e))},t}(),PageMgr=function(){function t(){this.curPage=0,this.msgList={};var t=window.previewData.list.length,e=window.GlobalData.user.id,i=window.GlobalData.roomId;this.allPage=t,this.userId=e,this.roomId=i}return Object.defineProperty(t,"cur_page",{get:function(){return this.pageMgr().curPage},enumerable:!0,configurable:!0}),Object.defineProperty(t,"key",{get:function(){return this.pageMgr().roomId+"-"+this.cur_page},enumerable:!0,configurable:!0}),Object.defineProperty(t,"all_page",{get:function(){return this.pageMgr().allPage},enumerable:!0,configurable:!0}),t.pageMgr=function(){return this._instance||(this._instance=new t),this._instance},t.cursorIcon=function(t,e,i){var n=document.body;if("auto"===t)return void(n.style.cursor="auto");var o='url("'+t+'") '+e+" "+i+", auto";n.style.cursor=o},t.receiveMsg=function(t){this.receiveMsgFilter(t)},t.receiveMsgFilter=function(t){var e=this,i=JSON.parse(t);this.pageMgr().msgList=new MsgFilters({currentMsg:this.pageMgr().msgList,newMsg:i});var n=Object.keys(i),o=!0;n.forEach(function(t,n){var r=i[t];r&&0!==r.length&&r.forEach(function(t){var i=JSON.parse(t),n=i.pageIndex;i.type,i.user;n!==e.pageMgr().curPage?(MyConsole.info("指令页码和课件页码不一致"+t,LogType.warn),o=!1):e.reveiveMsgCallback(t)})}),"ucPlugin"in window&&o&&window.ucPlugin.setState(this.key,JSON.stringify(this.pageMgr().msgList))},t.reveiveMsgCallback=function(t){var e=JSON.parse(t),i=e.pageIndex,n=e.id,o=e.cmd,r=e.moduleType;if(i!==this.cur_page&&(this.pageMgr().curPage=i,this.sureResourceIsFinish(i)),"0000"===o)return void this.pageMgr().resetPage();if(r)return void(1===r&&setTimeout(function(){window.Observer.getInstance().fire("topic",t)},0));var s=this.pageMgr().getPreviewPagePictures(),a=s.find(function(t){return t.image.data.id===n}),h=a&&a.image;h&&h.receiveMsg&&h.receiveMsg(t)},t.sendMsg=function(t){if(window.GlobalData.isAuthority||1!==window.GlobalData.userType){var e=JSON.parse(t).id;t=Object.assign(JSON.parse(t),{pageIndex:this.cur_page,user:window.GlobalData.user});var i=JSON.stringify(t),n=(o={},o[e]=[i],o);callbackInSendMsg(JSON.stringify(n));var o}},t.prevPage=function(){MyConsole.info("--> 上一页"),this.pageMgr().curPage<=1||(this.pageMgr().curPage--,this.sureResourceIsFinish(this.cur_page))},t.nextPage=function(){this.pageMgr().curPage>=this.all_page||(this.pageMgr().curPage++,this.sureResourceIsFinish(this.cur_page))},t.turnPage=function(t){var e=parseInt(t,10);e!==this.pageMgr().curPage&&(this.pageMgr().curPage=e,this.sureResourceIsFinish(e))},t.firstPageIsLoaded=function(){MyConsole.info("--> 默认首页加载完成 firstPageIsLoaded"),Logger("class PageMgr","callbackInResLoaded"),ClassrommMgr.callbackInResLoaded(t.all_page)},t.sureResourceIsFinish=function(t){var e=this;
0>=t||t>this.all_page||(this.pageMgr().clearMsgList(),window.Observer.getInstance().fire("topicHidden"),Lottie.hidden(),setTimeout(function(){e.pageMgr().exchangePage(t-1);for(var i=!!window.previewData.list[t-1].interactControl,n=window.previewData.list[t-1].elements,o=!1,r=0;r<n.length;r++)if(e.manyActionType.includes(n[r].type)){o=!0;break}Logger("class PageMgr","callbackInPageLoaded",!o,i),ClassrommMgr.callbackInPageLoaded(!o,i),(new PageInfo).sendInfo(window.previewData.list[t-1])},0))},t.prototype.exchangePage=function(t){Logger("class PageMgr","翻页",t),this.initMsg(t),(new Preview).go(t)},t.prototype.clearMsgList=function(){this.msgList={}},t.prototype.getPreviewPagePictures=function(){return(new Preview).pictureList[(new Preview).pageIndex]},t.prototype.initMsg=function(t){for(var e=window.previewData.list[t].elements,i=0,n=e.length;n>i;i++){var o=e[i];o.type===UUType.ANSWER_QUESTION&&window.Observer.getInstance().fire("topicShow",t+1)}},t.prototype.resetPage=function(){(new Preview).resetPage()},t.manyActionType=[UUType.ANSWER_QUESTION],t}(),DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return MyConsole.info("login"),[2]})})},t}();window.platform||(window.platform=new DebugPlatform);var Preview=function(t){function e(){var i=t.call(this)||this;return i.width=1024,i.height=768,i.pages=[],i.pageList=[],i.pageIndex=0,i.displayGroup=new eui.Group,i.pictureList=[],i.observer=ObserverNew.getInstance(),i.game=new Game,i.preloadNum=1,i.preloadResourceNum=2,i.eventObj={},e._instance||(Logger("class Preview","Preview 创建Preview场景","开始"),i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),e._instance=i),e._instance}return __extends(e,t),e.prototype.draw=function(t){MyConsole.info("Preview draw...",LogType.info),this.pageIndex=t,this.game.addChild(this)},e.prototype.undraw=function(){this.observer.clear(),this.game.removeChild(this)},e.prototype.getPages=function(){this.pages=window.previewData.list},e.prototype.go=function(t){MyConsole.info("this.pageList..."),MyConsole.info("this.displayGroup..."),this.pageIndex=t,this.displayGroup.removeChildren();var e=this.pageList[t];if(e||(e=this.renderSinglePage(t),this.pageList[t]=e),this.prePage=e,this.displayGroup.addChild(e),t+this.preloadNum<=this.pages.length-1){var i=this.pageList[t+this.preloadNum];i||(i=this.renderSinglePage(t+this.preloadNum),this.pageList[t+this.preloadNum]=i),this.displayGroup.addChildAt(i,0)}for(var n=t;n<=t+this.preloadResourceNum;n++)this.preloadResource(n);this.observer.clear(),this.listenAnimate()},e.prototype.drawComById=function(t){var i=this.pictureList[this.pageIndex],n=i.find(function(e){return e.image.data.id===t});n&&n.draw((new e).prePage)},e.prototype.drawComByIdForCard=function(t){for(var e=this.pictureList[this.pageIndex],i=e.find(function(e){return e.image.data.id===t}),n=e.findIndex(function(t){return[UUType.CARDALERT,UUType.CARDALERT_SW].includes(t.image.data.type)}),o=-1,r=this.prePage.$children,s=this.prePage.numChildren,a=s-1;a>=0;a--){var h=r[a].data&&r[a].data.type;if(h===UUType.CARDALERT||h===UUType.CARDALERT_SW){o=a;break}}if(i)if(-1===o){var d=i.transform.matrix;i.image.matrix=new egret.Matrix(d.a,d.b,d.c,d.d,d.x,d.y),this.prePage.addChildAt(i.image,n+1)}else{var d=i.transform.matrix;i.image.matrix=new egret.Matrix(d.a,d.b,d.c,d.d,d.x,d.y),this.prePage.addChildAt(i.image,o+1)}},e.prototype.undrawComByType=function(t){var i=this.pictureList[this.pageIndex],n=i.filter(function(e){return e.image.data.type===t});n.length&&n.forEach(function(t){return t.undraw((new e).prePage)})},e.prototype.hasComInPrePage=function(t){var e=this.prePage.$children.map(function(t){return t.data&&t.data.type});return e.includes(t)},e.prototype.getComById=function(t){return this.prePage.$children.find(function(e){return e.data&&e.data.id===t})},e.prototype.getDisComByMatchId=function(t){return this.prePage.$children.find(function(e){return e.data&&e.data.props&&e.data.props.matchId===t&&e.data.type===UUType.DRAWDISTINATIONMAINIMAGE?e:void 0})},e.prototype.resetPage=function(){this.displayGroup.removeChild(this.prePage),this.displayGroup.addChild(this.prePage)},e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.onAddToStage=function(t){MyConsole.info("Preview onAddToStage..."),this.pageList.length=0,this.initEui(),this.getPages();var e=this.renderSinglePage(this.pageIndex);this.pageList[this.pageIndex]=e,Logger("class Preview","Preview 所有资源加载+首页数据预渲染","结束"),PageMgr.firstPageIsLoaded()},e.prototype.initEui=function(){MyConsole.info("Preview initEui..."),this.displayGroup.width=this.width,this.displayGroup.height=this.height,this.displayGroup.scrollEnabled=!0,this.addChild(this.displayGroup)},e.prototype.renderSinglePage=function(t){var e=this.pages[t].elements,i=new SinglePageGroup(this.width,this.height,e),n=i.getPicturs();return this.pictureList[t]=n,i},e.prototype.listenAnimate=function(){var t=this;MyConsole.info("**** listenAnimate ****",LogType.obj);for(var e=this.pages[this.pageIndex].properties.triggerGroup,i=function(i,o){var r=e[i],s=r.originTarget,a=r.aimTagrget,h=r.animateType,d=s.id,c=a.id;n.observer.register(a,h,function(){MyConsole.info("**** 触发交互动效 ****",LogType.obj);var e=t.pictureList[t.pageIndex].filter(function(t){return t.image.data.id===d})[0].image,i=t.pictureList[t.pageIndex].filter(function(t){return t.image.data.id===c})[0];switch(h){case"show":i.image[h]&&i.image[h]();break;default:i.image[h]&&i.image[h](e)}});var u=n.pictureList[n.pageIndex].filter(function(t){return t.image.data.id===d})[0].image;if(!u)return{value:void 0};if(u.data.type===UUType.BTNANSWERSTART)return{value:void 0};u.touchEnabled=!0;var l=u.data.id;n.eventObj[l]&&u.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,n.eventObj[l],n),n.eventObj[l]=function(){t.observer.emit(a,h)},u.addEventListener(egret.TouchEvent.TOUCH_BEGIN,n.eventObj[l],n)},n=this,o=0,r=e.length;r>o;o++){var s=i(o,r);if("object"==typeof s)return s.value}},e.prototype.preloadResource=function(t){if(MyConsole.info("preloadResource..."),!(t>this.pages.length-1||0>t)){var e=this.pages[t];e.resources.length&&e.resources.forEach(function(t){RES.getResAsync(t)})}},e}(eui.Group),SinglePageGroup=function(t){function e(e,i,n){var o=t.call(this)||this;return o.elements=[],o.pictures=[],o.width=e,o.height=i,o.elements=n,o.init(n),o.addEventListener(egret.Event.ADDED_TO_STAGE,o.onAddToStage,o),o.addEventListener(egret.Event.REMOVED_FROM_STAGE,o.onRemoveFromStage,o),o}return __extends(e,t),e.prototype.drawComponents=function(){for(var t=this,e=[],i=0,n=this.pictures.length;n>i;i++){var o=this.pictures[i],r=o.image.data;if(r.type!==UUType.CARDALERT&&r.type!==UUType.CARDALERT_SW&&(r.type!==UUType.VIDEO||(new Preview).prePage===this)){var s=window.GlobalData;s&&1===s.userType&&2===r.viewType||(r.type!==UUType.DRAWMAINIMAGE?o.draw(this):e.push(o))}}e.forEach(function(e){e.draw(t)})},e.prototype.getPicturs=function(){return this.pictures},e.prototype.onAddToStage=function(){MyConsole.info("--> SinglePageGroup onAddToStage"),this.drawComponents()},e.prototype.onRemoveFromStage=function(){MyConsole.info("--> SinglePageGroup onRemoveFromStage..."),MyConsole.info("--> elements...");for(var t=0,e=this.pictures.length;e>t;t++){var i=this.pictures[t],n=i.image.data;n.type===UUType.VIDEO&&i.undraw(this)}for(var t=0,e=this.elements.length;e>t;t++)var n=this.elements[t]},e.prototype.init=function(t){for(var e=[],i=LayerSet.getIsNotEgretUUType(),n=0,o=t.length;o>n;n++)if(!i.includes(t[n].type)){var r=LayerSet.getLayer(Utils.getComs(),t[n].type)[0],s=LayerSet.createInstance(r,t[n].props);if(s.name=t[n].id,s.data=t[n],t[n].type===UUType.IMAGE||t[n].type===UUType.BACKGROUND||t[n].type===UUType.DRAWIMAGE||t[n].type===UUType.TEACHINGIMG||t[n].type===UUType.DRAWDISTINATIONMAINIMAGE||t[n].type===UUType.DRAWMAINIMAGE){var a=t[n].src;s.source=a}var h=new Picture(s,t[n].matrix);e.push(h)}this.pictures=e,this.createBg(),this.drawComponents()},e.prototype.undrawComponents=function(){for(var t=0,e=this.pictures.length;e>t;t++){var i=this.pictures[t],n=i.image.data;if(n.isView){var o=window.GlobalData;o&&1===o.userType&&2===n.viewType||i.undraw(this)}}},e.prototype.createBg=function(){var t=new eui.Rect(this.width,this.height,10539081);this.addChild(t)},e}(eui.Group),ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function o(t){e.call(n,t)}function r(e){e.resItem.url===t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(n))}var s=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(n,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(n,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var a=t.split("/");a.pop();var h=a.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(n,generateJSON.paths[t])},this):RES.getResByUrl(h,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){e.call(n,generateJSON.paths[t])},s)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(n,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_TEXT)},t}(),Utils=function(){function t(){}return t.getComs=function(){return Components.getComs()},t.getTexture=function(t){var e=this;return new Promise(function(i,n){RES.getResByUrl(t,function(t){i(t)},e,RES.ResourceItem.TYPE_IMAGE)})},t}(),Game=function(t){function e(){var i=t.call(this)||this;return e._instance||(Logger("class Game","Game 创建场景","开始"),i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStageInit,i),e._instance=i),e._instance}return __extends(e,t),e.prototype.initEui=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){return t=new eui.Group,t.x=0,t.y=0,this.addChild(t),e=new egret.Shape,e.graphics.beginFill(13421772,1),e.graphics.drawRect(0,0,this.width,this.height),e.graphics.endFill(),t.addChild(e),this.preview.width=this.width,this.preview.height=this.height,this.preview.x=0,this.preview.y=0,this.preview.scrollEnabled=!0,t.addChild(this.preview),Logger("class Preview","Preview 创建Preview场景","结束"),Logger("class Game","Game 创建场景","结束"),[2]})})},e.prototype.onAddToStageInit=function(t){mouse.enable(this.stage),mouse.setMouseMoveEnabled(!0),this.preview=new Preview,this.initEui()},e}(eui.Component),Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.textfield=new egret.TextField,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),Logger("class Main","egret注入全局方法","开始"),egret.ImageLoader.crossOrigin="anonymous",egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){},egret.lifecycle.onResume=function(){};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),Logger("class Main","egret注入全局方法","完成"),Logger("class Main","runGame 加载公共资源 创建场景","开始"),this.runGame()["catch"](function(t){Logger("class Main","runGame 加载公共资源 创建场景","完成"),MyConsole.info(t)})},e.prototype.createGameScene=function(){var t=new Game;t.width=this.width,t.height=this.height,this.addChild(t)},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i=this;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),ShowLoadMsg(document.getElementById("msgCover"),MsgCover("preload")),[4,RES.loadConfig("data/preload.json","")];case 1:return n.sent(),ShowLoadMsg(document.getElementById("msgCover"),MsgCover("preloadEnd")),t=new LoadingUI("display"),ShowLoadMsg(document.getElementById("msgCover"),MsgCover("loading")),this.stage.addChild(t),[4,RES.loadGroup("preload",0,t)];case 2:return n.sent(),ShowLoadMsg(document.getElementById("msgCover"),MsgCover("loadingEnd")),this.createGameScene(),setTimeout(function(){i.stage.removeChild(t),loadingBegin()},500),[3,4];case 3:return e=n.sent(),MyConsole.info(e),[3,4];case 4:return[2]}})})},e.prototype.createMsg=function(){var t=new egret.TextField;return t.textColor=6710886,t.width=this.stage.stageWidth,t.textAlign="center",t.size=16,t.y=610,t},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.startAnimation=function(t){var e=this,i=new egret.HtmlTextParser,n=t.map(function(t){return i.parse(t)}),o=this.textfield,r=-1,s=function(){r++,r>=n.length&&(r=0);var t=n[r];o.textFlow=t;var i=egret.Tween.get(o);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(s,e)};s()},e}(eui.UILayer),Components=function(){function t(){}return t.getComs=function(){return[UUBackground,UUVideo,DrawImage,BtnReset,StarFlicker,CardAlertSwitch,AudioSmall,UUImage,Slideshow]},t}(),UUBackground=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.layerName="背景",e.width=1024,e.height=768,e}return __extends(e,t),e.uuType=UUType.BACKGROUND,e}(eui.Image),UUVideo=function(t){function e(e){var i=t.call(this)||this;return i.layerName="视频",i.width=824,i.height=620,i.mode=1,i.templateResources={postUrl:""},i.videoWidth=824,i.videoHeight=620,i.postUrl="resource/template/Video/Video_posts1.jpeg",i.startUrl="common_template#play",i.pauseUrl="common_template#pause",i.stopUrl="common_template#stop",i.playState="stop",MyConsole.info("--> UUVideo Instance",LogType.obj),i.mediaSrc=e.mediaSrc,i.posterPath=e.posterPath,i.mode=e.mode,e.templateResources.postUrl=i.postUrl,2===i.mode&&(i.width=912,i.height=512,i.videoWidth=912,i.videoHeight=512,i.postUrl="resource/template/Video/Video_posts2.jpeg",e.templateResources.postUrl=i.postUrl),i.posterPath&&(i.postUrl=i.posterPath,e.templateResources.postUrl=""),e.width&&e.height&&(i.width=e.width,i.height=e.height),i.touchEnabled=!1,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i.addEventListener(egret.Event.REMOVED_FROM_STAGE,i.onRemoveFromStage,i),i}return __extends(e,t),e.prototype.receiveMsg=function(t){this.receiveMsgFn(t)},e.prototype.receiveMsgFn=function(t){var e=this,i=this.getMobileOperatingSystem();return"iOS"!==i?void this.receiveHandle(t):void(this.webVideo.canPlay()?this.receiveHandle(t):this.webVideo.video.addEventListener("loadedmetadata",function(){e.receiveHandle(t)},{capture:!1,once:!0}))},e.prototype.receiveHandle=function(t){var e=JSON.parse(t),i=e.cmd;switch(i){case 1001:this.play();break;case 1002:this.pause();break;case 99:this.stop()}},e.prototype.onAddToStage=function(t){MyConsole.info("--> UUVideo onAddToStage",LogType.obj),this.loadVideo()},e.prototype.onRemoveFromStage=function(t){MyConsole.info("--> UUVideo onRemoveFromStage",LogType.obj),this.playState="stop",this.webVideo&&this.webVideo.clear()},e.prototype.init=function(){},e.prototype.loadVideo=function(){1===window.GlobalData.handleStatus?this.loadVideoByElement():this.loadVideoByEgret()},e.prototype.loadVideoByEgret=function(){var t=this,e=1===this.mode?4/3:16/9,i=UIFactory.createImage(this.postUrl);this.addChild(i);var n=function(){var n=i.width/i.height;n>e?(i.width=t.width,i.height=i.width/n):(i.height=t.height,i.width=t.height*n)};i.width&&n(),i.addEventListener(egret.Event.COMPLETE,function(){n()},this),i.horizontalCenter=0,i.verticalCenter=0},e.prototype.loadVideoByElement=function(){this.webVideo=new WebVideo(this.data.id,this.videoWidth,this.videoHeight,this.data.matrix),this.webVideo.src=this.mediaSrc,this.webVideo.setPoster(this.postUrl),this.webVideo.setCanPlay(this.init.bind(this),this),this.webVideo.setEnded(this.onComplete.bind(this),this)},e.prototype.play=function(){MyConsole.info("--> UUVideo play",LogType.obj),"play"!==this.playState&&(this.playState="play",this.webVideo&&this.webVideo.play())},e.prototype.pause=function(){"play"===this.playState&&(this.playState="pause",this.webVideo&&this.webVideo.pause())},e.prototype.stop=function(){"stop"!==this.playState&&(this.playState="stop",this.webVideo&&this.webVideo.stop(),this.webVideo.reload())},e.prototype.onComplete=function(t){this.stop()},e.prototype.getMobileOperatingSystem=function(){var t=navigator.userAgent||navigator.vendor;return/windows phone/i.test(t)?"Windows Phone":/android/i.test(t)?"Android":/iPad|iPhone|iPod/.test(t)?"iOS":"unknown"},e.uuType=UUType.VIDEO,e}(eui.Group),DrawImage=function(t){function e(e){var i=t.call(this)||this;i.layerName="拖拽",i.templateResources={soundDown:""},i.soundDown="",i.debounceTime=100,MyConsole.info("DrawImage Instance");var n=e.templateResources.soundDown;return i.soundDown=n,i.soundDownCom=new UUSoundCom(i.soundDown),i.touchEnabled=!0,i.once(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i}return __extends(e,t),e.prototype.receiveMsg=function(t){var e=JSON.parse(t),i=e.cmd,n=e.x,o=e.y,r=e.user,s=r.id;switch(i){case 505:this.down(n,o);break;case 501:if(s===window.GlobalData.user.id)return;this.move(n,o);break;case 503:this.up(n,o)}},e.prototype.onAddToStage=function(t){this.init()},e.prototype.init=function(){this.addFilter(),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.downMsg,this)},e.prototype.down=function(t,e){this.removeFilter(),this.x=t,this.y=e},e.prototype.move=function(t,e){this.x=t,this.y=e},e.prototype.up=function(t,e){var i=this;this.soundDownCom.play(),this.addFilter(),setTimeout(function(){i.x=t,i.y=e},this.debounceTime)},e.prototype.addFilter=function(){this.filters=[FilterFactory.createGlodFilter()]},e.prototype.removeFilter=function(){this.filters=[]},e.prototype.debounceFn=function(t){var e=null,i=this;return function(n,o){e&&clearTimeout(e),e=setTimeout(function(){e=null,t(n,o)},i.debounceTime)}},e.prototype.downMsg=function(t){t.preventDefault(),this.stage.addEventListener(Mouse.MOVE,this.moveMsg,this),this.stage.addEventListener(Mouse.END,this.upMsg,this),this.distanceX=t.stageX-this.x,this.distanceY=t.stageY-this.y;var e=Math.floor(t.stageX-this.distanceX),i=Math.floor(t.stageY-this.distanceY),n={cmd:505,type:4,x:e,y:i,id:this.data.id};PageMgr.sendMsg(JSON.stringify(n))},e.prototype.moveMsg=function(t){t.preventDefault();var e=Math.floor(t.stageX-this.distanceX),i=Math.floor(t.stageY-this.distanceY),n={cmd:501,type:4,x:e,y:i,id:this.data.id};this.move(e,i),this.debounce||(this.debounce=this.debounceFn(function(t,e){n.x=t,n.y=e,PageMgr.sendMsg(JSON.stringify(n))})),this.debounce(e,i)},e.prototype.upMsg=function(t){this.debounce=null,t.preventDefault(),this.stage.removeEventListener(Mouse.MOVE,this.moveMsg,this),this.stage.removeEventListener(Mouse.END,this.upMsg,this);var e=Math.floor(t.stageX-this.distanceX),i=Math.floor(t.stageY-this.distanceY),n={cmd:503,type:5,x:e,y:i,id:this.data.id};PageMgr.sendMsg(JSON.stringify(n))},e.uuType=UUType.DRAWIMAGE,e}(eui.Image),BtnReset=function(t){function e(){var e=t.call(this,"common_template#btn_reset")||this;return e.layerName="reset按钮",e.isDraw=!1,e.once(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.resetPage,this)},e.prototype.resetPage=function(){var t=this.$parent,e=t.$children,i=e.filter(function(t){return!!t.reset});return MyConsole.info("resetChildList..."),i.length?void i.forEach(function(t){return t.reset&&t.reset()}):void PageMgr.sendMsg(JSON.stringify({cmd:"0000",type:1,id:this.data.id}))},e.uuType=UUType.BTNRESET,e}(UUButton),StarFlicker=function(t){function e(){var e=t.call(this)||this;return e.layerName="闪光特效",e.width=250,e.height=200,e.once(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.onGroupComplete()},e.prototype.onGroupComplete=function(){for(var t=this,e=["star_play_tex#xingxing2","star_play_tex#xingxing3","star_play_tex#xingxing4","star_play_tex#xingxing5","star_play_tex#xingxing6","star_play_tex#xingxing7","star_play_tex#xingxing8","star_play_tex#xingxing9","star_play_tex#xingxing10","star_play_tex#xingxing11","star_play_tex#xingxing12"],i=[[50,50],[100,50],[150,50],[200,50],[250,50],[50,100],[100,100],[150,100],[200,100],[250,100],[50,150]],n=[],o=0,r=e.length;r>o;o++){var s=RES.getRes(e[o]),a=new egret.Bitmap(s);a.x=i[o][0],a.y=i[o][1],n.push(a),this.addChild(a)}var h=1,d=function(){t.removeChild(n[1]),t.removeChild(n[3]),t.removeChild(n[5]),t.removeChild(n[7]),t.removeChild(n[9]),t.addChild(n[0]),t.addChild(n[2]),t.addChild(n[4]),t.addChild(n[6]),t.addChild(n[8]),t.addChild(n[10])},c=function(){t.addChild(n[1]),t.addChild(n[3]),t.addChild(n[5]),t.addChild(n[7]),t.addChild(n[9]),t.removeChild(n[0]),t.removeChild(n[2]),t.removeChild(n[4]),t.removeChild(n[6]),t.removeChild(n[8]),t.removeChild(n[10])};this.timer=setInterval(function(){1===h?d():c(),h++,h%=2},300)},e.uuType=UUType.StarFlicker,e}(eui.Group),CardAlertSwitch=function(t){function e(e){var i=t.call(this)||this;i.layerName="弹卡",i.mode=0,i.mediaSrc="",i.templateResources={bdUrl:"",soundOpen:"",soundClose:""},i.width=679,i.height=461,i.bdUrl="",i.soundOpen="",i.soundClose="",i.btnClose="common_template#close2",MyConsole.info("CardAlertSwitch Instance");var n=e.templateResources,o=n.bdUrl,r=n.soundOpen,s=n.soundClose;return i.bdUrl=o,i.soundOpen=r,i.soundClose=s,i.soundOpenCom=new UUSoundCom(i.soundOpen),i.soundCloseCom=new UUSoundCom(i.soundClose),i.mode=e.mode,i.img=e.img,i.mediaSrc=e.mediaSrc,i.mode&&(i.bdUrl="resource/template/CardAlert/type1/CardAlert_type1_bg"+i.mode+".png",e.templateResources.bdUrl=i.bdUrl),i.touchEnabled=!1,i.onAddToStage(),i.addEventListener(egret.Event.REMOVED_FROM_STAGE,i.onRemoveFromStage,i),i}return __extends(e,t),e.prototype.show=function(){if(!(new Preview).getComById(this.data.id)){var t={cmd:201,type:5,id:this.data.id};PageMgr.sendMsg(JSON.stringify(t))}},e.prototype.receiveMsg=function(t){var e=JSON.parse(t),i=e.cmd;switch(i){case 201:this.showPanel();break;case 202:this.closePanel();break;case 203:this.playAudio()}},e.prototype.onAddToStage=function(){MyConsole.info("CardAlert onAddToStage"),this.init()},e.prototype.onRemoveFromStage=function(t){MyConsole.info("CardAlertSwitch onRemoveFromStage"),this.$parent&&this.$parent.removeChild(this)},e.prototype.init=function(){var t=this,e=UIFactory.createImage(this.img);this.addChild(e),e.addEventListener(egret.Event.COMPLETE,function(){if(t.width=e.width,t.height=e.height,t.mode){var i=UIFactory.createImage(t.btnClose,68,68);i.left=15,i.top=15,i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,t.closePanelMsg,t),t.addChild(i)}t.mediaSrc&&(t.audio=new AudioSmall({mediaSrc:t.mediaSrc},!0),t.audio.x=55,t.audio.y=t.height-66,t.addChild(t.audio),t.audio.addEventListener(egret.TouchEvent.TOUCH_TAP,t.playAudioMsg,t))},this)},e.prototype.closePanel=function(){this.$parent&&this.$parent.removeChild(this),this.soundCloseCom.play()},e.prototype.showPanel=function(){(new Preview).drawComByIdForCard(this.data.id),this.soundOpenCom.play()},e.prototype.playAudio=function(){this.audio.play()},e.prototype.playAudioMsg=function(){var t={cmd:203,type:4,id:this.data.id};PageMgr.sendMsg(JSON.stringify(t))},e.prototype.closePanelMsg=function(){var t={cmd:202,type:5,id:this.data.id};PageMgr.sendMsg(JSON.stringify(t))},e.uuType=UUType.CARDALERT_SW,e}(eui.Group),AudioSmall=function(t){function e(e,i){void 0===i&&(i=!1);var n=t.call(this,e.mediaSrc)||this;return n.layerName="小音频",n.width=46,n.height=33,n.startUrl="common_template#sound",n.playState="stop",n.isFinish=!0,n.myScaleX=1,n.myScaleY=1,n.isChildCom=i,MyConsole.info("AudioSmall Instance"),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n}return __extends(e,t),e.prototype.initUI=function(){this.startBtn=this.createStartImg(),this.addChild(this.startBtn)},e.prototype.onAddToStage=function(t){MyConsole.info("AudioSmall onAddToStage"),this.myScaleX=this.scaleX,this.myScaleY=this.scaleY,1===window.GlobalData.handleStatus&&(this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.x+=this.width*this.myScaleX/2,this.y+=this.height*this.myScaleY/2)},e.prototype.onRemoveFromStage=function(){t.prototype.onRemoveFromStage.call(this),this.isFinish=!0},e.prototype.audioClick=function(){"stop"===this.playState&&this.playMsg()},e.prototype.play=function(){this.isFinish&&(this.isFinish=!1,t.prototype.play.call(this),this.playState="playing",this.exchangePlayState())},e.prototype.stop=function(){t.prototype.stop.call(this),this.playState="stop",this.exchangePlayState()},e.prototype.receiveMsg=function(t){var e=JSON.parse(t),i=e.cmd;switch(i){case 1402:this.play()}},e.prototype.createStartImg=function(){var t=UIFactory.createImage(this.startUrl);return t.percentWidth=100,t.percentHeight=100,t.horizontalCenter=0,t.verticalCenter=0,t.touchEnabled=!0,this.isChildCom||t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.audioClick,this),t},e.prototype.exchangePlayState=function(){var t=this,e=egret.Tween.get(this);switch(this.playState){case"stop":e.to({scaleX:this.myScaleX,scaleY:this.myScaleY},1e3).call(function(){t.isFinish=!0});break;case"playing":e.to({scaleX:2,scaleY:2},1e3)}},e.prototype.playMsg=function(){var t={cmd:1402,type:4,id:this.data.id};PageMgr.sendMsg(JSON.stringify(t))},e.uuType=UUType.AudioSmall,e}(UUSound),UUImage=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.layerName="图片",e.isDraw=!1,e}return __extends(e,t),e.uuType=UUType.IMAGE,e}(eui.Image),Slideshow=function(t){function e(e){var i=t.call(this)||this;i.layerName="切卡片",i.mode=1,i.imgList=[],i.mediaList=[],i.templateResources={bgUrl:"",borderUrl:"",soundClick:"",soundChange:""},i.width=886,i.height=457,i.bgUrl="",i.borderUrl="",i.soundClick="",i.soundChange="",i.leftArrowUrl="common_template#arrow_left",i.rightArrowUrl="common_template#arrow_right",i.bgWidth=694,i.bgHeight=457,i.itemWidth=657,i.itemHeight=435,i.duration=500,i.delayed=100,i.isAnimating=!1,i._activeIndex=0,i.audioList=[],i.directionQueue=[],MyConsole.info("Slideshow Instance");var n=e.templateResources,o=n.bgUrl,r=n.borderUrl,s=n.soundClick,a=n.soundChange;i.bgUrl=o,i.borderUrl=r,i.soundClick=s,i.soundChange=a,i.soundClickCom=new UUSoundCom(i.soundClick),i.soundChangeCom=new UUSoundCom(i.soundChange);var h=e.mode||1;return i.imgList=e.imgList.filter(function(t){return!!t.url}),i.mediaList=e.mediaList,i.borderUrl="resource/template/Slideshow/type1/Slideshow_type1_border"+h+".png",e.templateResources.borderUrl=i.borderUrl,i.touchEnabled=!1,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i.addEventListener(egret.Event.REMOVED_FROM_STAGE,i.onRemoveFromStage,i),i}return __extends(e,t),Object.defineProperty(e.prototype,"activeIndex",{get:function(){return this._activeIndex},set:function(t){this._activeIndex=t,this.arrowLeft.visible=!0,this.arrowRight.visible=!0,0===t&&(this.arrowLeft.visible=!1),t===this.imgList.length-1&&(this.arrowRight.visible=!1)},enumerable:!0,configurable:!0}),e.prototype.receiveMsg=function(t){this.executeDirection(t)},e.prototype.onAddToStage=function(t){MyConsole.info("Slideshow onAddToStage"),this.init(),this.arrowLeft.visible=!1},e.prototype.onRemoveFromStage=function(t){MyConsole.info("Slideshow onRemoveFromStage"),this.removeChildren(),this.activeIndex=0,this.isAnimating=!1},e.prototype.init=function(){this.addChild(this.createBg()),this.addChild(this.createLeftArrow()),this.addChild(this.createRightArrow())},e.prototype.createBg=function(){var t=UIFactory.createGroup(this.bgWidth,this.bgHeight);t.verticalCenter=0,t.horizontalCenter=0;var e=UIFactory.createImage(this.bgUrl,this.bgWidth,this.bgHeight);return t.addChild(e),this.mainBox=this.createMianBox(),t.addChild(this.mainBox),t},e.prototype.createMianBox=function(){var t=UIFactory.createGroup(this.itemWidth,this.itemHeight);this.imgList=this.imgList.filter(function(t){return!!t.url});for(var e=this.imgList.length,i=e-1;i>=0;i--){var n=this.imgList[i],o=this.mediaList[i],r=this.createitem(n.url,o.src,i);t.addChild(r)}return t.verticalCenter=0,t.horizontalCenter=0,this.imgBox=t,t},e.prototype.createitem=function(t,e,i){var n=UIFactory.createGroup(this.itemWidth,this.itemHeight),o=UIFactory.createImage(this.borderUrl,this.itemWidth,this.itemHeight);n.addChild(o);var r=UIFactory.createImage(t,616,393);if(r.x=16,r.y=16,n.addChild(r),e){var s=new AudioSmall({mediaSrc:e,id:this.data.id+(i+"")},!0);s.x=41,s.y=355,n.addChild(s),this.audioList[i]=s,s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.playAudioMsg,this)}return n},e.prototype.createLeftArrow=function(){var t=UIFactory.createImage(this.leftArrowUrl,71,95);return t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclickLeftMsg,this),t.verticalCenter=0,t.left=0,this.arrowLeft=t,t},e.prototype.createRightArrow=function(){var t=UIFactory.createImage(this.rightArrowUrl,71,95);return t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclickRightMsg,this),t.verticalCenter=0,t.right=0,this.arrowRight=t,t},e.prototype.handleDirectionQueue=function(){if(this.directionQueue.length){var t=this.directionQueue.shift();this.executeDirection(t)}},e.prototype.reArrange=function(t){if(this.activeIndex!==t){this.activeIndex=t,this.mainBox.removeChildren(),this.audioList.length=0;for(var e=this.imgList.length,i=e-1;i>=0;i--){var n=i+t>=this.imgList.length?i+t-this.imgList.length:i+t,o=this.imgList[n],r=this.mediaList[n],s=this.createitem(o.url,r.src,n);this.mainBox.addChild(s)}}},e.prototype.onclickLeft=function(){var t=this;if(!(this.activeIndex<=0)){this.audioList.forEach(function(t){return t.stop()}),this.playSound(),this.isAnimating=!0;var e=this.imgBox.getChildAt(0),i=egret.Tween.get(e);i.to({x:e.width},this.duration).call(function(){t.imgBox.setChildIndex(e,t.imgBox.numChildren-1)}).wait(this.delayed).to({x:0},this.duration).call(function(){t.isAnimating=!1,t.activeIndex-=1,t.handleDirectionQueue()}).wait(this.delayed)}},e.prototype.onclickRight=function(){var t=this;if(!(this.activeIndex>=this.imgList.length-1)){this.audioList.forEach(function(t){return t.stop()}),this.playSound(),this.isAnimating=!0;var e=this.imgBox.getChildAt(this.imgBox.numChildren-1),i=egret.Tween.get(e);i.to({x:e.width},this.duration).call(function(){t.imgBox.setChildIndex(e,0)}).wait(this.delayed).to({x:0},this.duration).call(function(){t.isAnimating=!1,t.activeIndex+=1,t.handleDirectionQueue()}).wait(this.delayed)}},e.prototype.onclickAudio=function(t){var e=JSON.parse(t),i=e.cardId;this.activeIndex===i&&this.audioList[i]&&this.audioList[i].play()},e.prototype.playSound=function(){var t=this;this.soundClickCom.play(),setTimeout(function(){t.soundClickCom.stop(),t.soundChangeCom.play()},500)},e.prototype.onclickLeftMsg=function(){if(!(this.activeIndex<=0||this.isAnimating)){var t={id:this.data.id,cmd:802,type:5,cardId:this.activeIndex};PageMgr.sendMsg(JSON.stringify(t))}},e.prototype.onclickRightMsg=function(){if(!(this.activeIndex>=this.imgList.length-1||this.isAnimating)){var t={id:this.data.id,cmd:801,type:5,cardId:this.activeIndex};PageMgr.sendMsg(JSON.stringify(t))}},e.prototype.playAudioMsg=function(){var t={cmd:803,type:4,id:this.data.id,cardId:this.activeIndex};PageMgr.sendMsg(JSON.stringify(t))},e.prototype.executeDirection=function(t){if(this.isAnimating){var e=JSON.parse(t).cmd;return void((801===e||802===e)&&this.directionQueue.push(t))}var i=JSON.parse(t),n=i.cmd,o=i.cardId;switch(this.reArrange(o),n){case 801:this.onclickRight();break;case 802:this.onclickLeft();break;case 803:this.onclickAudio(t)}},e.uuType=UUType.SLIDESHOW,e}(eui.Group);
