(function(t){function e(e){for(var o,s,r=e[0],c=e[1],l=e[2],h=0,d=[];h<r.length;h++)s=r[h],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&d.push(i[s][0]),i[s]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(t[o]=c[o]);u&&u(e);while(d.length)d.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],o=!0,r=1;r<n.length;r++){var c=n[r];0!==i[c]&&(o=!1)}o&&(a.splice(e--,1),t=s(s.s=n[0]))}return t}var o={},i={app:0},a=[];function s(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=o,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)s.d(n,o,function(e){return t[e]}.bind(null,o));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=e,r=r.slice();for(var l=0;l<r.length;l++)e(r[l]);var u=c;a.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"0b84":function(t,e,n){},1:function(t,e){},2:function(t,e){},3:function(t,e){},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("2b0e"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"fill",attrs:{id:"app"}},[n("BaseFabric",{staticClass:"fill"})],1)},a=[],s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("canvas",{ref:"draw",staticClass:"panel"}),n("ul",[n("li",[n("van-button",{attrs:{size:"small",plain:""},on:{click:t.selectFileHandler}},[t._v("照片")]),n("input",{staticStyle:{display:"none"},attrs:{id:"fileInput",type:"file",accept:"image/png,image/jpeg,image/jpg,image/bmp"},on:{change:t.fileChangeHandler}})],1),n("li",[n("van-button",{attrs:{type:"primary",size:"small"},on:{click:t.drawLineHandler}},[t._v("画线")])],1),n("li",[n("van-button",{attrs:{type:"primary",size:"small"},on:{click:t.drawTextHandler}},[t._v("文本")])],1),n("li",[n("van-button",{attrs:{type:"primary",size:"small"},on:{click:t.selectHandler}},[t._v("选择")])],1),n("li",[n("van-button",{attrs:{type:"primary",size:"small"},on:{click:t.translationHandler}},[t._v("平移")])],1),n("li",[n("van-button",{attrs:{type:"danger",size:"small"},on:{click:t.clearHandler}},[t._v("清除")])],1),n("li",[n("van-button",{attrs:{type:"primary",size:"small"},on:{click:t.saveHandler}},[t._v("保存")])],1)]),n("van-slider",{attrs:{min:.25,max:3,step:.01,vertical:!0},on:{"update:model-value":t.sliderChangeHandler},model:{value:t.zoom,callback:function(e){t.zoom=e},expression:"zoom"}})],1)},r=[],c=(n("159b"),n("7a94")),l={name:"BaseFabric",data:function(){return{canvas:null,zoom:1,isDragging:!1,drawType:"line",mouseDown:!1,lastPosX:0,lastPosY:0}},mounted:function(){var t=this,e=this.$refs.draw,n=e.parentElement.getBoundingClientRect();e.setAttribute("width",n.width+"px"),e.setAttribute("height",n.height+"px"),this.$nextTick((function(){t.init(e)})),document.addEventListener("keydown",(function(e){var n=window.event?e.keyCode:e.which;8==n&&t.canvas.remove(t.canvas.getActiveObject())}))},methods:{init:function(t){var e=this,n=this.canvas=new c["fabric"].Canvas(t,{isDrawingMode:!1});c["fabric"].Object.prototype.transparentCorners=!1,n.freeDrawingBrush&&(n.freeDrawingBrush.color="#ff0",n.freeDrawingBrush.width=10,n.freeDrawingBrush.shadow=new c["fabric"].Shadow({blur:0,offsetX:0,offsetY:0,affectStroke:!0,color:"blue"})),console.log("canvas",n,this.$refs.draw),n.on("touch:gesture",(function(t){console.log("touch:gesture",t.e.type,t.e.touches)})),n.on("touch:drag",(function(t){console.log("touch:drag",t.e.type,t.e.touches)})),n.on("mouse:down",this.mouseDownHandler.bind(this)),n.on("mouse:up",this.mouseUpHandler.bind(this)),n.on("mouse:move",this.mouseMoveHandler.bind(this)),this.drawLineHandler(),n.on("mouse:wheel",(function(t){var o=t.e,i=o.deltaY,a=n.getZoom();a*=Math.pow(.999,i),a>3&&(a=3),a<.25&&(a=.25),e.zoom=a,n.zoomToPoint({x:o.offsetX,y:o.offsetY},a),o.preventDefault(),o.stopPropagation();var s=e.canvas.viewportTransform;a<.4?(s[4]=200-1e3*a/2,s[5]=200-1e3*a/2):(s[4]>=0?s[4]=0:s[4]<e.canvas.getWidth()-1e3*a&&(s[4]=e.canvas.getWidth()-1e3*a),s[5]>=0?s[5]=0:s[5]<e.canvas.getHeight()-1e3*a&&(s[5]=e.canvas.getHeight()-1e3*a))}))},mouseDownHandler:function(t){console.log("down....",this.canvas.isDrawingMode,t),this.mouseDown=!0,this.startTime=Date.now(),this.mouseFrom=t.pointer;var e=t.e;this.lastPosX="touchstart"==e.type?e.targetTouches[0].clientX:e.clientX,this.lastPosY="touchstart"==e.type?e.targetTouches[0].clientY:e.clientY},mouseUpHandler:function(t){console.log("up....",this.canvas.isDrawingMode,t),this.mouseDown=!1,this.startTime=0,this.mouseTo=t.pointer,"line"===this.drawType?(this.startDrawing(t.e),this.canvasObject=null):"textbox"===this.drawType?(t.target||this.drawTextBox(t.e),this.selection(!1)):"move"===this.drawType&&this.canvas.setViewportTransform(this.canvas.viewportTransform)},mouseMoveHandler:function(t){if(this.mouseDown&&(this.mouseTo=t.pointer,Date.now()-this.startTime>=30&&"line"===this.drawType&&(this.startTime=Date.now(),this.startDrawing(t.e)),"move"===this.drawType)){var e=t.e,n=this.canvas.viewportTransform,o="touchmove"==e.type?e.targetTouches[0].clientX:e.clientX,i="touchmove"==e.type?e.targetTouches[0].clientY:e.clientY;n[4]+=o-this.lastPosX,n[5]+=i-this.lastPosY,console.log(o,this.lastPosX,i-this.lastPosY),this.canvas.requestRenderAll(),this.lastPosX=o,this.lastPosY=i}},startDrawing:function(){this.canvasObject&&this.canvas.remove(this.canvasObject),this.canvasObject=new c["fabric"].Line([this.mouseFrom.x,this.mouseFrom.y,this.mouseTo.x,this.mouseTo.y],{fill:"#409EFF",stroke:"#F56C6C",strokeWidth:2,strokeLineJoin:"round"}),this.canvasObject.selectable=!1,this.canvas.add(this.canvasObject)},drawTextBox:function(t){["mouseup","touchend"].indexOf(t.type)>=0&&(this.textBoxObject&&(this.textBoxObject.exitEditing(),this.canvas.discardActiveObject()),this.textBoxObject=this.createTextBox(this.mouseFrom,this.mouseTo,""),this.textBoxObject.setControlsVisibility({bl:!0,br:!0,mb:!1,ml:!0,mr:!0,mt:!1,tl:!0,tr:!0,mtr:!0}),console.log("这是文本框",this.textBoxObject),this.canvas.add(this.textBoxObject),this.textBoxObject.enterEditing(),this.canvasObject.selectable=!1)},createTextBox:function(t,e,n){return new c["fabric"].Textbox(n,{fontSize:15,left:t.x,top:t.y,fill:"#409EFF",originX:"left",width:e.x-t.x,height:e.y-t.y,backgroundColor:"rgba(83, 168, 255, 0.35)",editingBorderColor:"rgb(83, 168, 255)",strokeWidth:10,breakWords:!0})},sliderChangeHandler:function(){this.canvas.setZoom(this.zoom),this.canvas.requestRenderAll(),"wx"in window&&window["wx"].showToast({titile:"值"+this.zoom})},drawLineHandler:function(){this.drawType="line",this.selection(!1),this.textBoxObject&&this.textBoxObject.exitEditing()},drawTextHandler:function(){this.drawType="textbox",this.selection(!1)},selectHandler:function(){this.drawType="select",this.canvas&&(this.selection(!0),this.textBoxObject&&this.textBoxObject.exitEditing())},translationHandler:function(){this.selectHandler(),this.drawType="move"},clearHandler:function(){this.canvas.clear()},selectFileHandler:function(t){"wx"in window?window["wx"].chooseImage({count:1,success:function(t){console.log(t),console.log(t.tempFilePaths)}}):document.getElementById("fileInput").click(t)},selection:function(t){this.canvas.selection=!1,this.canvas.skipTargetFind=!1,this.canvas.discardActiveObject(),this.canvas.getObjects().forEach((function(e){e.selectable=t}))},fileChangeHandler:function(t){var e=this;console.log("文件地址",t.target),console.log("this.files",t.target.files);var n=new FileReader;n.addEventListener("load",(function(){c["fabric"].Image.fromURL(n.result,(function(t){t.scale(.5).set({left:0,top:0,angle:0,clipTo:function(t){t.arc(0,0,300,0,2*Math.PI,!0)}}),e.canvas.add(t),e.drawLineHandler()}))})),n.readAsDataURL(t.target.files[0])},saveHandler:function(){var t=this.canvas.toDataURL({width:this.canvas.width,height:this.canvas.height,left:0,top:0,format:"png"});if(window.postMessage(t,"*"),"wx"in window)window["wx"].downloadImage({url:t,type:"image",success:function(t){console.log("文件下载完成",t)},fail:function(t){console.log("download fail",t)},complete:function(t){console.log("download complete",t)}}),console.log("已经向微信小程序发送消息",t);else{console.warn("微信插件未加载");var e=document.createElement("a");e.style.display="none",e.href=t,e.download="canvas.png",document.body.appendChild(e),e.click(),setTimeout((function(){document.body.removeChild(e)}),100)}}}},u=l,h=(n("e73b"),n("2877")),d=Object(h["a"])(u,s,r,!1,null,"276addfb",null),f=d.exports,p={name:"App",components:{BaseFabric:f},created:function(){}},v=p,m=(n("b044"),Object(h["a"])(v,i,a,!1,null,null,null)),w=m.exports,g=n("b970");n("157a");o["a"].use(g["a"]),o["a"].config.productionTip=!1,new o["a"]({render:function(t){return t(w)}}).$mount("#app")},"8ae7":function(t,e,n){},b044:function(t,e,n){"use strict";n("8ae7")},e73b:function(t,e,n){"use strict";n("0b84")}});
//# sourceMappingURL=app.5f8a0aac.js.map