(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-dae56d66"],{8432:function(e,t,n){},"9e8f":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-main",[n("el-header",[e._v(" Node WebRTC Recorder ")]),n("el-row",{staticClass:"video-container"},[n("video",{attrs:{autoplay:""},domProps:{srcObject:e.localStream}})]),n("el-row",{staticClass:"center"},[n("el-switch",{attrs:{"active-text":"屏幕","inactive-text":"摄像头"},model:{value:e.selectValue,callback:function(t){e.selectValue=t},expression:"selectValue"}}),e.recording?n("el-button",{attrs:{type:"danger"},on:{click:e.stopRecorder}},[e._v("停止录制")]):n("el-button",{attrs:{type:"primary"},on:{click:e.startRecorder}},[e._v("开始录制")])],1)],1)},c=[],o=(n("99af"),n("4160"),n("ac1f"),n("5319"),n("159b"),n("5530")),a=(n("96cf"),n("1da1")),s=n("a18f"),i=n.n(s),u=n("4e0d"),l="https://local.uuabc.com:2020",p="/wrtc",d={name:"NodeWebRTCRecorder",data:function(){return{selectValue:!1,recording:!1,localStream:null,peerConnection:null}},mounted:function(){},methods:{beforeAnswer:function(e){var t=arguments,n=this;return Object(a["a"])(regeneratorRuntime.mark((function r(){var c,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(c={video:!0,audio:!0},!n.selectValue){r.next=7;break}return r.next=4,window.navigator.mediaDevices.getDisplayMedia(c);case 4:n.localStream=r.sent,r.next=10;break;case 7:return r.next=9,window.navigator.mediaDevices.getUserMedia(c);case 9:n.localStream=r.sent;case 10:n.localStream.getTracks().forEach((function(t){return e.addTrack(t,n.localStream)})),o=e.close,e.close=function(){return n.localStream.getTracks().forEach((function(e){return e.stop()})),n.localStream=null,o.apply(n,t)};case 13:case"end":return r.stop()}}),r)})))()},enableStereoOpus:function(e){return e.replace(/a=fmtp:111/,"a=fmtp:111 stereo=1\r\na=fmtp:111")},createConnection:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var r,c,a,s,d,f,m,w,b;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e=Object(o["a"])({beforeAnswer:function(){},stereo:!1},e),r=e,c=r.beforeAnswer,a=r.stereo,n.next=4,i()("".concat(l).concat(p,"/connections"),{method:"POST"});case 4:return s=n.sent,console.log("connections",s),n.next=8,s.json();case 8:return d=n.sent,console.log("remotePeerConnection",d),f=d.id,m=new u["RTCPeerConnection"]({sdpSemantics:"unified-plan"}),m.close=function(){t.recording=!1,i()("".concat(l).concat(p,"/connections/").concat(f),{method:"delete"}).then((function(e){console.log("-- close ---")})).catch((function(e){console.log("-- close  error ---",e)}))},n.prev=13,n.next=16,m.setRemoteDescription(d.localDescription);case 16:return n.next=18,c(m);case 18:return t.recording=!0,n.next=21,m.createAnswer();case 21:return w=n.sent,b=new u["RTCSessionDescription"]({type:"answer",sdp:a?t.enableStereoOpus(w.sdp):w.sdp}),n.next=25,m.setLocalDescription(b);case 25:return n.next=27,i()("".concat(l).concat(p,"/connections/").concat(f,"/remote-description"),{method:"POST",body:JSON.stringify(m.localDescription),headers:{"Content-Type":"application/json"}});case 27:return n.abrupt("return",m);case 30:throw n.prev=30,n.t0=n["catch"](13),m.close(),n.t0;case 34:case"end":return n.stop()}}),n,null,[[13,30]])})))()},startRecorder:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.createConnection({beforeAnswer:e.beforeAnswer});case 2:e.peerConnection=t.sent;case 3:case"end":return t.stop()}}),t)})))()},stopRecorder:function(){this.peerConnection&&this.peerConnection.close()}}},f=d,m=(n("ee30"),n("2877")),w=function(e){e.options.__source="src/guide/views/webrtc/NodeWebRTCRecorder.vue"},b=w,h=Object(m["a"])(f,r,c,!1,null,"086155b1",null);"function"===typeof b&&b(h);t["default"]=h.exports},ee30:function(e,t,n){"use strict";var r=n("8432"),c=n.n(r);c.a}}]);