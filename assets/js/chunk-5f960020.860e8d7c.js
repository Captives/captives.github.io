(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5f960020"],{"4e0d":function(e,n,t){"use strict";n.MediaStream=window.MediaStream,n.MediaStreamTrack=window.MediaStreamTrack,n.RTCDataChannel=window.RTCDataChannel,n.RTCDataChannelEvent=window.RTCDataChannelEvent,n.RTCDtlsTransport=window.RTCDtlsTransport,n.RTCIceCandidate=window.RTCIceCandidate,n.RTCIceTransport=window.RTCIceTransport,n.RTCPeerConnection=window.RTCPeerConnection,n.RTCPeerConnectionIceEvent=window.RTCPeerConnectionIceEvent,n.RTCRtpReceiver=window.RTCRtpReceiver,n.RTCRtpSender=window.RTCRtpSender,n.RTCRtpTransceiver=window.RTCRtpTransceiver,n.RTCSctpTransport=window.RTCSctpTransport,n.RTCSessionDescription=window.RTCSessionDescription,n.getUserMedia=window.getUserMedia,n.mediaDevices=navigator.mediaDevices},8432:function(e,n,t){},"99af":function(e,n,t){"use strict";var r=t("23e7"),o=t("d039"),c=t("e8b5"),a=t("861d"),i=t("7b0b"),s=t("50c4"),u=t("8418"),l=t("65f0"),d=t("1dde"),p=t("b622"),f=t("2d00"),w=p("isConcatSpreadable"),R=9007199254740991,C="Maximum allowed index exceeded",T=f>=51||!o((function(){var e=[];return e[w]=!1,e.concat()[0]!==e})),m=d("concat"),v=function(e){if(!a(e))return!1;var n=e[w];return void 0!==n?!!n:c(e)},h=!T||!m;r({target:"Array",proto:!0,forced:h},{concat:function(e){var n,t,r,o,c,a=i(this),d=l(a,0),p=0;for(n=-1,r=arguments.length;n<r;n++)if(c=-1===n?a:arguments[n],v(c)){if(o=s(c.length),p+o>R)throw TypeError(C);for(t=0;t<o;t++,p++)t in c&&u(d,p,c[t])}else{if(p>=R)throw TypeError(C);u(d,p++,c)}return d.length=p,d}})},"9e8f":function(e,n,t){"use strict";t.r(n);var r=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("el-main",[t("el-header",[e._v(" Node WebRTC Recorder ")]),t("el-row",{staticClass:"video-container"},[t("video",{attrs:{autoplay:""},domProps:{srcObject:e.localStream}})]),t("el-row",{staticClass:"center"},[t("el-switch",{attrs:{"active-text":"屏幕","inactive-text":"摄像头"},model:{value:e.selectValue,callback:function(n){e.selectValue=n},expression:"selectValue"}}),e.recording?t("el-button",{attrs:{type:"danger"},on:{click:e.stopRecorder}},[e._v("停止录制")]):t("el-button",{attrs:{type:"primary"},on:{click:e.startRecorder}},[e._v("开始录制")])],1)],1)},o=[],c=(t("99af"),t("4160"),t("ac1f"),t("5319"),t("159b"),t("5530")),a=(t("96cf"),t("1da1")),i=t("a18f"),s=t.n(i),u=t("4e0d"),l="https://local.uuabc.com:2020",d="/wrtc",p={name:"NodeWebRTCRecorder",data:function(){return{selectValue:!1,recording:!1,localStream:null,peerConnection:null}},mounted:function(){},methods:{beforeAnswer:function(e){var n=arguments,t=this;return Object(a["a"])(regeneratorRuntime.mark((function r(){var o,c;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(o={video:!0,audio:!0},!t.selectValue){r.next=7;break}return r.next=4,window.navigator.mediaDevices.getDisplayMedia(o);case 4:t.localStream=r.sent,r.next=10;break;case 7:return r.next=9,window.navigator.mediaDevices.getUserMedia(o);case 9:t.localStream=r.sent;case 10:t.localStream.getTracks().forEach((function(n){return e.addTrack(n,t.localStream)})),c=e.close,e.close=function(){return t.localStream.getTracks().forEach((function(e){return e.stop()})),t.localStream=null,c.apply(t,n)};case 13:case"end":return r.stop()}}),r)})))()},enableStereoOpus:function(e){return e.replace(/a=fmtp:111/,"a=fmtp:111 stereo=1\r\na=fmtp:111")},createConnection:function(e){var n=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var r,o,a,i,p,f,w,R,C;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=Object(c["a"])({beforeAnswer:function(){},stereo:!1},e),r=e,o=r.beforeAnswer,a=r.stereo,t.next=4,s()("".concat(l).concat(d,"/connections"),{method:"POST"});case 4:return i=t.sent,console.log("connections",i),t.next=8,i.json();case 8:return p=t.sent,console.log("remotePeerConnection",p),f=p.id,w=new u["RTCPeerConnection"]({sdpSemantics:"unified-plan"}),w.close=function(){n.recording=!1,s()("".concat(l).concat(d,"/connections/").concat(f),{method:"delete"}).then((function(e){console.log("-- close ---")})).catch((function(e){console.log("-- close  error ---",e)}))},t.prev=13,t.next=16,w.setRemoteDescription(p.localDescription);case 16:return t.next=18,o(w);case 18:return n.recording=!0,t.next=21,w.createAnswer();case 21:return R=t.sent,C=new u["RTCSessionDescription"]({type:"answer",sdp:a?n.enableStereoOpus(R.sdp):R.sdp}),t.next=25,w.setLocalDescription(C);case 25:return t.next=27,s()("".concat(l).concat(d,"/connections/").concat(f,"/remote-description"),{method:"POST",body:JSON.stringify(w.localDescription),headers:{"Content-Type":"application/json"}});case 27:return t.abrupt("return",w);case 30:throw t.prev=30,t.t0=t["catch"](13),w.close(),t.t0;case 34:case"end":return t.stop()}}),t,null,[[13,30]])})))()},startRecorder:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.createConnection({beforeAnswer:e.beforeAnswer});case 2:e.peerConnection=n.sent;case 3:case"end":return n.stop()}}),n)})))()},stopRecorder:function(){this.peerConnection&&this.peerConnection.close()}}},f=p,w=(t("ee30"),t("2877")),R=function(e){e.options.__source="src/guide/views/webrtc/NodeWebRTCRecorder.vue"},C=R,T=Object(w["a"])(f,r,o,!1,null,"086155b1",null);"function"===typeof C&&C(T);n["default"]=T.exports},a18f:function(e,n,t){"use strict";var r=function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof o)return o;throw new Error("unable to locate global object")},o=r();e.exports=n=o.fetch,o.fetch&&(n.default=o.fetch.bind(o)),n.Headers=o.Headers,n.Request=o.Request,n.Response=o.Response},ee30:function(e,n,t){"use strict";var r=t("8432"),o=t.n(r);o.a}}]);