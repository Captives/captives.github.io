(function(e){function t(t){for(var o,c,a=t[0],s=t[1],u=t[2],l=0,d=[];l<a.length;l++)c=a[l],Object.prototype.hasOwnProperty.call(r,c)&&r[c]&&d.push(r[c][0]),r[c]=0;for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o]);f&&f(t);while(d.length)d.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],o=!0,c=1;c<n.length;c++){var a=n[c];0!==r[a]&&(o=!1)}o&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var o={},c={live:0},r={live:0},i=[];function a(e){return s.p+"assets/js/"+({}[e]||e)+"."+{"chunk-71a35f82":"d25b6709","chunk-d2f5d200":"a3bc04c3"}[e]+".js"}function s(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.e=function(e){var t=[],n={"chunk-71a35f82":1,"chunk-d2f5d200":1};c[e]?t.push(c[e]):0!==c[e]&&n[e]&&t.push(c[e]=new Promise((function(t,n){for(var o="assets/css/"+({}[e]||e)+"."+{"chunk-71a35f82":"05bdf02b","chunk-d2f5d200":"e1366bbd"}[e]+".css",r=s.p+o,i=document.getElementsByTagName("link"),a=0;a<i.length;a++){var u=i[a],l=u.getAttribute("data-href")||u.getAttribute("href");if("stylesheet"===u.rel&&(l===o||l===r))return t()}var d=document.getElementsByTagName("style");for(a=0;a<d.length;a++){u=d[a],l=u.getAttribute("data-href");if(l===o||l===r)return t()}var f=document.createElement("link");f.rel="stylesheet",f.type="text/css",f.onload=t,f.onerror=function(t){var o=t&&t.target&&t.target.src||r,i=new Error("Loading CSS chunk "+e+" failed.\n("+o+")");i.code="CSS_CHUNK_LOAD_FAILED",i.request=o,delete c[e],f.parentNode.removeChild(f),n(i)},f.href=r;var m=document.getElementsByTagName("head")[0];m.appendChild(f)})).then((function(){c[e]=0})));var o=r[e];if(0!==o)if(o)t.push(o[2]);else{var i=new Promise((function(t,n){o=r[e]=[t,n]}));t.push(o[2]=i);var u,l=document.createElement("script");l.charset="utf-8",l.timeout=120,s.nc&&l.setAttribute("nonce",s.nc),l.src=a(e);var d=new Error;u=function(t){l.onerror=l.onload=null,clearTimeout(f);var n=r[e];if(0!==n){if(n){var o=t&&("load"===t.type?"missing":t.type),c=t&&t.target&&t.target.src;d.message="Loading chunk "+e+" failed.\n("+o+": "+c+")",d.name="ChunkLoadError",d.type=o,d.request=c,n[1](d)}r[e]=void 0}};var f=setTimeout((function(){u({type:"timeout",target:l})}),12e4);l.onerror=l.onload=u,document.head.appendChild(l)}return Promise.all(t)},s.m=e,s.c=o,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(n,o,function(t){return e[t]}.bind(null,o));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s.oe=function(e){throw console.error(e),e};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],l=u.push.bind(u);u.push=t,u=u.slice();for(var d=0;d<u.length;d++)t(u[d]);var f=l;i.push([1,"chunk-vendors"]),n()})({"0c0c":function(e,t,n){"use strict";var o=n("f299"),c=n.n(o);c.a},1:function(e,t,n){e.exports=n("8729")},2:function(e,t){},"4b34":function(e,t,n){"use strict";n("d3b7");var o=n("2b0e"),c=n("8c4f");o["default"].use(c["a"]);var r=[{path:"/",name:"登入",component:function(){return n.e("chunk-71a35f82").then(n.bind(null,"630a"))}},{path:"/one",name:"一对一",component:function(){return n.e("chunk-d2f5d200").then(n.bind(null,"b9b8"))}},{path:"/many",name:"一对多",component:function(){return n.e("chunk-d2f5d200").then(n.bind(null,"b9b8"))}},{path:"/live",name:"直播",component:function(){return n.e("chunk-d2f5d200").then(n.bind(null,"b9b8"))}},{path:"/desc",name:"说明",component:function(){return n.e("chunk-d2f5d200").then(n.bind(null,"b9b8"))}}],i=new c["a"]({base:"",routes:r});t["a"]=i},8729:function(e,t,n){"use strict";n.r(t);n("4de4"),n("6eba"),n("0d03"),n("e260"),n("e6cf"),n("cca6"),n("a79d");var o,c,r=n("2b0e"),i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("router-view",{attrs:{id:"app"}})},a=[],s={name:"App",mounted:function(){var e=this;window.onresize=function(){e.elementEvent.emit("resize",document.documentElement)}}},u=s,l=(n("0c0c"),n("2877")),d=Object(l["a"])(u,i,a,!1,null,null,null),f=d.exports,m=n("4b34"),h=n("2f62"),p=(n("7db0"),n("a434"),n("ade3")),v={SET_USER:"setUser",USER_LIST:"userList",USER_ADD:"userAdd",USER_REMOVE:"userItem"},b={namespaced:!0,state:{user:null,userList:[]},mutations:(o={},Object(p["a"])(o,v.SET_USER,(function(e,t){e.user=t})),Object(p["a"])(o,v.USER_LIST,(function(e,t){e.userList=t})),Object(p["a"])(o,v.USER_ADD,(function(e,t){for(var n in e.userList)e.userList[n].id===t.id&&e.userList[n].role===t.role&&e.userList.splice(n,1);e.userList.push(t)})),Object(p["a"])(o,v.USER_REMOVE,(function(e,t){for(var n in e.userList)e.userList[n].id===t.id&&e.userList[n].role===t.role&&e.userList.splice(n,1)})),o),actions:{setUser:function(e,t){var n=e.commit;n(v.SET_USER,t)},initUsers:function(e,t){var n=e.commit;n(v.USER_LIST,t)},pushUser:function(e,t){var n=e.commit;n(v.USER_ADD,t)},removeUser:function(e,t){var n=e.commit;n(v.USER_REMOVE,t)}},getters:{getUserById:function(e){return function(t){return e.userList.find((function(e){return e.id==t}))}}}},g={START_SUBJECT:"start",INIT_LIST:"initList",ADD_RESULT:"addResult",RESET:"reset"},S={namespaced:!0,state:{starting:!1,list:[]},mutations:(c={},Object(p["a"])(c,g.START_SUBJECT,(function(e,t){e.starting=!0})),Object(p["a"])(c,g.INIT_LIST,(function(e,t){e.list=t})),Object(p["a"])(c,g.ADD_RESULT,(function(e,t){e.list.push(t)})),Object(p["a"])(c,g.RESET,(function(e,t){e.starting=!1,e.list=[]})),c),actions:{startSubject:function(e,t){var n=e.commit;n(g.START_SUBJECT,t)},initResults:function(e,t){var n=e.commit;n(g.INIT_LIST,t)},addResult:function(e,t){var n=e.commit;n(g.ADD_RESULT,t)},stopSubject:function(e,t){var n=e.commit;n(g.RESET,t)}},getters:{getResultById:function(e){return function(t){return e.list.find((function(e){return e.id==t}))}}}},y={namespaced:!0,state:{user:null,userList:[]},mutations:{},actions:{},getters:{}};r["default"].use(h["a"]);var k=new h["a"].Store({modules:{UserData:b,SubjectData:S,VideoData:y}}),O={PUBLISHER:1,SUBSCRIBER:2,1:"PUBLISHER",2:"SUBSCRIBER"},j=function(e){var t=new Date(e);return t.toLocaleDateString()==(new Date).toLocaleDateString()?t.toLocaleTimeString("chinese",{hour12:!1}):t.toLocaleString("chinese",{hour12:!1})},E=function(e){e=Math.floor(e/1e3);var t="-";e>=0&&(t=""),e=Math.round(Math.abs(e));var n=Math.floor(e/3600)%24,o=Math.floor(e/60)%60,c=e%60,r="";return 0!=n&&(r=n+":"),r+=r&&o<10?"0"+o:o+"",r+=c<10?":0"+c:":"+c,t+r},T=n("5c96"),w=n.n(T),L=(n("0fae"),n("d4ec")),I=n("bee2"),R=n("45eb"),_=n("7e84"),D=n("262e"),A=n("2caf"),U=n("8055"),P=n.n(U),C=n("faa1"),N=n.n(C),B=function(e){Object(D["a"])(n,e);var t=Object(A["a"])(n);function n(){return Object(L["a"])(this,n),t.call(this)}return n}(N.a.EventEmitter),V=B,M=function(e){Object(D["a"])(n,e);var t=Object(A["a"])(n);function n(){var e;return Object(L["a"])(this,n),e=t.call(this),e.count=5,e.connected=!1,e}return Object(I["a"])(n,[{key:"init",value:function(e,t){this.manager={path:t,secure:!0,transports:["websocket"],reconnection:!0,reconnectionAttempts:3},console.log(e,t),this.socket=P.a.connect(e,this.manager),this.listen(this.socket)}},{key:"listen",value:function(e){var t=this;e.on("connect",(function(){t.connected=!0,console.log("socket connected"),t.emit("connected")})),e.on("connect_error",(function(e){console.error("socket io","connect error",e),t.connected=!1})),e.on("connect_timeout",(function(){console.log("socket io","connect_timeout"),t.connected=!1})),e.on("disconnect",(function(){console.log("socket io","disconnect"),t.connected=!1,t.emit("disconnect",t.connected)})),e.on("reconnect",(function(e){console.log("socket io","reconnect",e)})),e.on("reconnect_attempt",(function(){console.log("socket io","reconnect attempt")})),e.on("reconnecting",(function(e){console.log("socket io","reconnecting",e),t.emit("reconnect",e,t.manager.reconnectionAttempts)})),e.on("reconnect_error",(function(e){console.error("socket io","reconnect error",e),t.connected=!1})),e.on("reconnect_failed",(function(){console.log("socket io","reconnect failed"),t.connected=!1,t.emit("closed")})),e.on("error",(function(e){console.error("socket io","error",e),t.connected=!1,t.emit("error")}))}},{key:"broadcast",value:function(e,t){this.connected&&this.socket.emit(e,t)}},{key:"close",value:function(){this.socket&&(this.socket.close(),this.emit("closed"))}}]),n}(V),x=M,J=function(e){Object(D["a"])(n,e);var t=Object(A["a"])(n);function n(){return Object(L["a"])(this,n),t.call(this)}return Object(I["a"])(n,[{key:"listen",value:function(e){var t=this;Object(R["a"])(Object(_["a"])(n.prototype),"listen",this).call(this,e),e.on("entry",(function(e){return t.emit("entry",e)})),e.on("list",(function(e){return t.emit("list",e)})),e.on("leave",(function(e){return t.emit("leave",e)})),e.on("start",(function(e){return t.emit("start",e)})),e.on("startTime",(function(e){return t.emit("startTime",e)})),e.on("reply",(function(e){return t.emit("reply",e)})),e.on("stop",(function(e){return t.emit("stop",e)})),e.on("page",(function(e){return t.emit("page",e)})),e.on("share",(function(e,n){e.event?t.emit("share",e.event,e.data,n):console.log("share",e)}))}},{key:"register",value:function(e,t,n,o,c){this.socket.emit("register",{td:e,id:t,name:n,role:o},c)}},{key:"subject",value:function(e,t,n){this.connected&&this.connected&&this.socket.emit("subject",{type:e,data:t},n)}}]),n}(x),q=J,z=(n("99af"),n("4160"),n("a15b"),n("d81d"),n("a9e3"),n("b64b"),n("d3b7"),n("e25e"),n("159b"),n("257e")),H=n("6b5f"),$=n.n(H);console.log("设备检测",$.a.checkSystemRequirements());var F=function(e){Object(D["a"])(n,e);var t=Object(A["a"])(n);function n(){var e;return Object(L["a"])(this,n),e=t.call(this),Object(p["a"])(Object(z["a"])(e),"cameras",[]),Object(p["a"])(Object(z["a"])(e),"microphones",[]),Object(p["a"])(Object(z["a"])(e),"audios",[]),Object(p["a"])(Object(z["a"])(e),"camera",null),Object(p["a"])(Object(z["a"])(e),"microphone",null),Object(p["a"])(Object(z["a"])(e),"localStream",null),Object(p["a"])(Object(z["a"])(e),"videoProfile",null),Object(p["a"])(Object(z["a"])(e),"videoElement",null),Object(p["a"])(Object(z["a"])(e),"streamID",null),e}return Object(I["a"])(n,[{key:"init",value:function(){var e=this;return new Promise((function(t,n){$.a.getDevices((function(o){e.audios=[],e.cameras=[],e.microphones=[],o&&o.length>0?(o.forEach((function(t){t=JSON.parse(JSON.stringify(t)),"videoinput"==t["kind"]?(t.label=t.label||"Camera "+(e.cameras.length+1),e.cameras.push(t)):"audioinput"==t["kind"]?(t.label=t.label||"Microphone "+(e.microphones.length+1),e.microphones.push(t)):"audiooutput"==t["kind"]&&(t.label=t.label||"Audio "+(e.audios.length+1),e.audios.push(t))})),t({videoinput:e.cameras,audioinput:e.microphones,audiooutput:e.audios})):n("DEVICES_NOT_FOUND")}))}))}},{key:"display",value:function(e,t){var n=this;return new Promise((function(o,c){console.log(n),n.localStream&&(n.localStream.isPlaying()&&n.localStream.stop(),n.localStream.play(e||n.videoElement,t,(function(e){e&&"aborted"!==e.status&&c({error:"播放失败，一般为浏览器策略阻止。引导用户用手势触发恢复播放"}),o()})))}))}},{key:"createStream",value:function(e){var t=this;return e=e||t.options,this.videoProfile=this.videoProfile||"360P_3",console.log("Create Stream",this.element,this.videoProfile,e),new Promise((function(n,o){t.localStream=$.a.createStream(e),t.localStream.setVideoProfile(t.videoProfile),t.localStream.on("accessAllowed",(function(){t.access=!0,console.log("localStream # accessAllowed")})),t.localStream.on("accessDenied",(function(){t.access=!1,console.warn("localStream # accessDenied")})),t.localStream.init((function(){console.log("getUserMedia successfully"),n(t.localStream)}),(function(e){console.log("getUserMedia failed",e),o(e.msg)}))}))}},{key:"switchDevice",value:function(e,t){var n=this;return new Promise((function(o,c){n.localStream.switchDevice(e,t,o,c)}))}},{key:"close",value:function(){null!=this.localStream&&this.localStream.close()}},{key:"options",get:function(){var e={streamID:parseInt(this.streamID),screen:!1,video:!1,audio:!1};return this.cameraId?(e.video=!0,e.cameraId=this.cameraId):this.cameras.length?e.video=!0:console.warn("没有视频设备, 无视频信号"),this.microphoneId?(e.audio=!0,e.microphoneId=this.microphoneId):this.microphones.length?e.audio=!0:console.warn("没有麦克风设备, 无音频信号"),e}},{key:"cameraId",set:function(e){var t=this.cameras||[];this.camera=t.find((function(t){return t.deviceId===e}))},get:function(){return this.camera?this.camera.deviceId:this.cameras.length>0?(this.camera=this.cameras[0],this.camera.deviceId):null}},{key:"microphoneId",set:function(e){var t=this,n=t.microphones||[];this.microphone=n.find((function(t){return t.deviceId===e}))},get:function(){return this.microphone?this.microphone.deviceId:this.microphones.length>0?(this.microphone=this.microphones[0],this.microphone.deviceId):null}}]),n}(V),K=function(e){Object(D["a"])(n,e);var t=Object(A["a"])(n);function n(){var e;return Object(L["a"])(this,n),e=t.call(this),Object(p["a"])(Object(z["a"])(e),"uid",null),Object(p["a"])(Object(z["a"])(e),"channel",null),Object(p["a"])(Object(z["a"])(e),"streamList",{}),Object(p["a"])(Object(z["a"])(e),"clinet",null),Object(p["a"])(Object(z["a"])(e),"appid",null),$.a.Logger.setLogLevel($.a.Logger.WARN),$.a.Logger.enableLogUpload(),console.log("AgoraRTC.BUILD",$.a.BUILD),e.client=$.a.createClient({mode:"live",codec:"vp8"}),e.addListener(e.client),e}return Object(I["a"])(n,[{key:"addListener",value:function(e){var t=this;e.on("stream-added",(function(t){var n=t.stream,o=n.getId();console.log("New stream added: ",o),console.log("Subscribe ",n),e.subscribe(n,(function(e){console.log("Subscribe stream failed",o,e)}))})),e.on("stream-subscribed",(function(e){var n=e.stream,o=n.getId();t.streamList[o]=n,console.log("Subscribe remote stream successfully: ",o,n.getAttributes(),"Video Track",n.getVideoTrack(),"Audio Track",n.getAudioTrack()),t.emit("stream",o)})),e.on("stream-removed",(function(e){var n=e.stream,o=n.getId();console.log("Remote stream is removed "+o),t.emit("removed",o),n.stop(),delete t.streamList[o]})),e.on("peer-leave",(function(e){var n=e.stream;if(n){var o=n.getId();console.log("Remote stream is removed "+o),t.emit("removed",o),n.stop(),delete t.streamList[o]}})),e.on("stream-reconnect-start",(function(e){console.log("尝试重新发布/订阅音视频流",e.uid)})),e.on("stream-reconnect-end",(function(e){console.log("重新发布/订阅音视频流结束",e.uid,e.success,e.reason)})),e.on("unmute-video",(function(e){var t=e.uid;console.log("unmute video:",t)})),e.on("client-banned",(function(e){var n=e.uid,o=e.attr;t.emit("rejected",n,o),console.warn(" user banned:"+n+", banntype:"+o)})),e.on("active-speaker",(function(e){var t=e.uid;console.log("update active speaker: client",t)})),e.on("volume-indicator",(function(e){var t=e.attr;t.forEach((function(e,t){console.log("".concat(t," UID ").concat(e.uid," Level ").concat(e.level))}))})),e.on("onTokenPrivilegeWillExpire",(function(){console.warn("---- token expire ----"),t.emit("tokenExpire")})),e.on("stream-type-changed",(function(e){console.log("Stream Type Change",e.uid,e.streamType)})),e.on("network-type-changed",(function(e){console.log("Network Type Changed to",e.networkType)})),e.on("camera-changed",(function(e){console.log("Camera Changed",e.state,e.device)})),e.on("recording-device-changed",(function(e){console.log("Recording Device Changed",e.state,e.device)})),e.on("playout-device-changed",(function(e){console.log("Playout Device Changed",e.state,e.device)})),e.on("reconnect",(function(){console.log("reconnect")})),e.on("connected",(function(){console.log("connected")})),e.on("connection-state-change",(function(e){t.connected="CONNECTED"===e.curState,console.log("Connection status changes",e.prevState,e.curState),t.emit("connection",e.prevState,e.curState)})),e.on("network-quality",(function(e){})),e.on("error",(function(e){console.error("AgoraRTC SDK Error:"+e),t.emit("error",e.reason)}))}},{key:"connect",value:function(e,t,n,o){var c=this,r=this;return this.appid=e,this.channel="AGD"+t,console.log("VIDEO CLIENT::",this.appid,this.channel),new Promise((function(e,t){r.appid?r.client.init(r.appid,(function(){r.client.join(o,c.channel,n,(function(t){r.uid=t,console.log("JOIN 成功",r.appid,c.channel,t),e(t)}),(function(e){t(e)}))}),(function(e){t(e)})):(console.warn("AgoraRTC appid must not be empty",r.appid),t("AgoraRTC appid must not be empty"+r.appid))}))}},{key:"publish",value:function(e){var t=this;return new Promise((function(n,o){t.client.publish(e,(function(e){console.warn("Publish local stream error: ",e),o(e)})),t.client.on("stream-published",(function(e){console.log("Publish local stream successfully"),n()}))}))}},{key:"getStream",value:function(e){var t=this.streamList[e];return t||console.warn("指定token的媒体流已经丢失",e)}},{key:"player",value:function(e,t,n){var o=this.getStream(e);return new Promise((function(c,r){o?(o.isPlaying()&&o.stop(),o.play(t,n||{fit:"contain"},(function(e){e&&"aborted"!==e.status&&r({error:"播放失败，一般为浏览器策略阻止。引导用户用手势触发恢复播放"}),c()}))):(console.warn("指定token的媒体流已经丢失或未获取...",e,t),r({error:"为查询到指定".concat(e,"的媒体流")}))}))}},{key:"stopPlayer",value:function(e,t){var n=this.getStream(e);n&&n.stop(),document.getElementById(t).innerText="",console.log(e,"Stream stopPlayer",e,this.streamList)}},{key:"toggleVideo",value:function(e,t){var n=this.getStream(e);t?n.unmuteVideo():(n.muteVideo(),console.log("视频图像已经关闭",e))}},{key:"getAudioVolume",value:function(e){var t=localStorage.getItem(this.channel+e);return Number(t||100)}},{key:"setAudioVolume",value:function(e,t){var n=this.getStream(e);n&&n.setAudioVolume(t),localStorage.setItem(this.channel+e,t)}},{key:"toggleAudio",value:function(e,t){var n=this.getStream(e);n&&(t?(n.muteAudio(),console.log("视频声音已经关闭 ",e)):n.unmuteAudio())}},{key:"unpublish",value:function(e,t){e&&this.client.unpublish(e,(function(e){switch(e){case"STREAM_NOT_YET_PUBLISHED":console.warn("指定的stream还没发布");break;case"INVALID_LOCAL_STREAM":console.warn("传入无效stream对象");break;case"INVALID_OPERATION":console.warn("当前不在频道中,取消订阅失败");break;default:console.error("Unpublish local stream failed",e)}t&&t(e)}))}},{key:"destroyed",value:function(){var e=this;return new Promise((function(t,n){Object.keys(e.streamList).map((function(t){e.stopPlayer(t)})),e.streamList={},e.client.leave((function(){console.log("Leavel channel successfully"),t()}),(function(e){console.warn("Leave channel failed"),n(e)}))}))}}]),n}(V),W=(n("e89b"),n("bc3a")),G=n.n(W),Y=n("a7fe"),Q=n.n(Y);r["default"].use(w.a,{size:"small",zIndex:3e3}),r["default"].prototype.client=new q,r["default"].prototype.elementEvent=new V,r["default"].prototype.videoStream=new F,r["default"].prototype.videoClient=new K,r["default"].prototype.$fingerprint=Date.now(),r["default"].filter("localTime",j),r["default"].filter("formatTimeValue",E),r["default"].use(Q.a,G.a),r["default"].prototype.RoleType=O,r["default"].config.productionTip=!1,window.vue=new r["default"]({store:k,router:m["a"],render:function(e){return e(f)}}).$mount("#app")},f299:function(e,t,n){}});