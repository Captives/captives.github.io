(function(e){function t(t){for(var i,s,r=t[0],l=t[1],c=t[2],d=0,p=[];d<r.length;d++)s=r[d],o[s]&&p.push(o[s][0]),o[s]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);u&&u(t);while(p.length)p.shift()();return a.push.apply(a,c||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],i=!0,r=1;r<n.length;r++){var l=n[r];0!==o[l]&&(i=!1)}i&&(a.splice(t--,1),e=s(s.s=n[0]))}return e}var i={},o={"video-monitor":0},a=[];function s(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=i,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=t,r=r.slice();for(var c=0;c<r.length;c++)t(r[c]);var u=l;a.push([10,"chunk-vendors","chunk-common"]),n()})({10:function(e,t,n){e.exports=n("8095")},"13db":function(e,t,n){e.exports=n.p+"static/img/logo_bottom.0d084403.png"},"420e":function(e,t,n){},5167:function(e,t,n){"use strict";var i=n("71fa"),o=n.n(i);o.a},5174:function(e,t,n){"use strict";var i=n("8c13"),o=n.n(i);o.a},"6eb2":function(e,t,n){"use strict";var i=n("efc1"),o=n.n(i);o.a},"713c":function(e,t,n){"use strict";var i=n("f4d3"),o=n.n(i);o.a},"71fa":function(e,t,n){},8095:function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var i,o=n("2b0e"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"wrapper"},[e.checked?[n("h1",{staticClass:"title"},[e._v(e._s(e.title))]),n("div",{staticClass:"container",style:{zoom:e.page.ratio}},[e.loading&&e.playing?n("video-display",{staticClass:"fill",attrs:{id:e.classId,token:e.token,muted:!1},on:{closed:e.videoClosed,destroy:e.videoDestroy}}):e._e(),e.loading&&!e.playing?n("video-player",{staticClass:"fill",attrs:{url:e.url},on:{error:e.errorHandler}}):e._e(),e.loading?e._e():n("span",{staticClass:"loading"},[e._v("loading...")])],1),n("div",{staticClass:"logo"},[n("img",{attrs:{src:e.logo}})]),e.loading&&!e.playing?n("BaseWindow",{directives:[{name:"show",rawName:"v-show",value:!e.url,expression:"!url"}],staticClass:"alert",attrs:{label:"刷新"},on:{change:e.refreshClick}},[e._v("暂时还不能观看，请稍后重试～")]):e._e(),e.playerror?n("BaseWindow",{staticClass:"alert",attrs:{label:"刷新"},on:{change:e.refreshClick}},[e._v("当前课程回放播放失败，请反馈到我们，我们来尽快帮您处理，谢谢您的谅解 拨打400-163-6161")]):e._e()]:e._e(),e.checked?e._e():[n("span",[e._v(e._s(e.title))])]],2)},s=[],r=(n("3b2b"),n("28a5"),n("c5f6"),n("7f7f"),n("cebc")),l=n("2f62"),c=n("337f"),u=n.n(c),d=n("13db"),p=n.n(d),f=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"box"},[n("div",{staticClass:"box-content"},[n("img",{attrs:{src:e.src}}),n("span",[e._t("default")],2),n("button",{on:{click:e.clickHandler}},[e._v(e._s(e.label))])])])},v=[],h=n("bfd5"),g=n.n(h),m={name:"BaseWindow",props:{label:{type:String,default:"标签"}},data:function(){return{src:g.a}},methods:{clickHandler:function(){this.$emit("change")}}},y=m,b=(n("5174"),n("2877")),_=Object(b["a"])(y,f,v,!1,null,"38880bab",null),w=_.exports,S=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"video-display"},[e.token?e._e():n("span",[e._v("未获取监控地址，请刷新后尝试！")]),e.token?n("div",{directives:[{name:"show",rawName:"v-show",value:e.playing,expression:"playing"}],staticClass:"video",attrs:{id:"videodisplay-"+e.id}}):e._e(),e.token?n("div",{directives:[{name:"show",rawName:"v-show",value:!e.playing,expression:"!playing"}],staticClass:"video-play",on:{click:e.videoPlayer}}):e._e()])},O=[],k=n("0a0d"),C=n.n(k),E=n("3d9c"),j={name:"VideoDisplay",props:{id:{type:String,default:""+C()()},token:{type:String,default:null},muted:{type:Boolean,default:!0}},data:function(){return{openVidu:null,session:null,loading:!0,playing:!1}},watch:{token:function(e){e&&this.init(e)},muted:function(e){document.querySelector("#videodisplay-"+this.id+" video");this.video&&(this.video.muted=e)}},mounted:function(){this.init(this.token)},methods:{init:function(e){if(e){var t=this;this.openVidu=new E["OpenVidu"],this.session=this.openVidu.initSession(),console.log("videodisplay",e,"init"),this.session.on("streamCreated",function(e){console.log("videodisplay # streamCreated",t.id);var n=t.session.subscribe(e.stream,"videodisplay-"+t.id);n.on("videoElementCreated",function(e){t.loading=!1;var n=e.element;n.muted=t.muted,n.onplay=function(e){t.playing=!0},n.onplaying=function(e){t.playing=!0},n.onpause=function(e){t.playing=!1},n.onended=function(e){t.playing=!1},n.onerror=function(e){t.playing=!1}})}),this.session.on("streamDestroyed",function(e){console.info("# >>>>",e.target.sessionId),t.$emit("destroy"),t.loading=!0}),this.session.connect(e).then(function(){console.log("connect success")}).catch(function(e){console.error("connect failed",e.code,e.message)})}},reload:function(){this.destory();var e=this;setTimeout(function(){e.init(e.token)},1e3)},videoPlayer:function(){var e=document.querySelector("#videodisplay-"+this.id+" video");e&&e.play()},fullScreen:function(){var e=document.querySelector("#videodisplay-"+this.id+" video");e&&(e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen&&e.webkitRequestFullScreen())},exitFullScreen:function(){var e=document.querySelector("#videodisplay-"+this.id+" video");e&&(e.exitFullscreen?e.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitCancelFullScreen&&e.webkitCancelFullScreen())},destory:function(){this.session&&(this.session.disconnect(),this.openVidu=null,this.session=null,this.$emit("closed"))}},destroyed:function(){this.destory()}},x=j,I=(n("713c"),n("5167"),Object(b["a"])(x,S,O,!1,null,"0123d15f",null)),T=I.exports,P=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"video"},[e.url?n("video",{directives:[{name:"show",rawName:"v-show",value:e.playing,expression:"playing"}],attrs:{src:e.url,preload:"true",autoplay:""},on:{play:function(t){e.playing=!0},playing:function(t){e.playing=!0},pause:function(t){e.playing=!1},ended:function(t){e.playing=!1},error:function(t){e.playing=!1}}},[e._v("your browser does not support the video tag")]):e._e(),e.url?n("div",{directives:[{name:"show",rawName:"v-show",value:!e.playing,expression:"!playing"}],staticClass:"player",on:{click:e.videoPlayer}}):e._e(),e.url?e._e():n("span",[e._v("未获取监课回放地址，请刷新后尝试")])])},R=[],q={name:"VideoPlayer",props:{url:{type:String,default:null}},data:function(){return{playing:!1}},methods:{videoPlayer:function(){var e=this,t=document.querySelector("video");t.onplay=function(t){e.playing=!0},t.onplaying=function(t){e.playing=!0},t.onpause=function(t){e.playing=!1},t.onended=function(t){e.playing=!1},t.onerror=function(t){e.playing=!1},t&&t.play().catch(function(t){e.$emit("error")})}}},F=q,A=(n("6eb2"),Object(b["a"])(F,P,R,!1,null,"4ce0f540",null)),V=A.exports,$={name:"app",components:{BaseWindow:w,VideoDisplay:T,VideoPlayer:V},data:function(){return{checked:!1,loading:!1,classId:null,title:"",token:null,url:null,logo:p.a,heartTimeId:0,playerror:!1}},computed:Object(r["a"])({},Object(l["c"])("page",{page:function(e){return e}})),methods:Object(r["a"])({},Object(l["b"])("page",["onResize"]),{init:function(e){var t=this;t.classId=e,this.$api.getClassInfo(e).then(function(e){var n=e.isSuccess,i=e.result;t.loading=!0,n&&(t.title=i.title,t.playing=i["exists"],i["exists"]?(t.token=i.token,t.heartTimeId=setInterval(function(){t.$api.testHeart()},5e3)):t.getVideoInfo())})},videoDestroy:function(){this.loading=!1,this.url=null,this.init(this.classId)},videoClosed:function(){clearInterval(this.heartTimeId),this.heartTimeId=0},getVideoInfo:function(){var e=this;this.$api.getPlayBackInfo(e.classId).then(function(t){var n=t.isSuccess,i=t.result;n&&(e.url=i.url)})},refreshClick:function(){window.location.reload()},errorHandler:function(){this.playerror=!0}}),mounted:function(){var e=this;this.onResize(document.documentElement),window.onresize=function(){e.onResize(document.documentElement)};var t=u.a.getParser(navigator&&navigator.userAgent),n=t.getBrowser();if("Safari"==n.name&&Number(n.version.split(".")[0])<11)this.checked=!1,this.title="发现您手机系统版本过低，不能进行家长监课；请先将您的手机系统升级到最新版本，再来观看吧～";else{var i=new RegExp("\\/playback\\/(\\d+)\\/","gi"),o=i.exec(window.location.href);o?(this.checked=!0,this.init(o[1])):this.title="无效课程地址"}}},N=$,z=(n("fb8d"),Object(b["a"])(N,a,s,!1,null,null,null)),D=z.exports,H=n("bd86"),B={SETROOM:"setRoom",UPDATE_STAGE:"updateStage",LEAVE:"LEAVE",ENDTHECLASS:"ENDTHECLASS"},M={namespaced:!0,state:{roomId:1,startTime:1,endTime:1},mutations:(i={},Object(H["a"])(i,B.SETROOM,function(e,t){e.roomId=t.room_id,e.startTime=t.start_time,e.endTime=t.end_time}),Object(H["a"])(i,B.UPDATE_STAGE,function(e,t){e.stageIndex=t}),i),actions:{setRoom:function(e,t){var n=e.commit;n(B.SETROOM,t)},updateStage:function(e,t){var n=e.commit;n(B.UPDATE_STAGE,t)}},getters:{}},W={ON_RESIZE:"onResize"},L={namespaced:!0,state:{width:1280,height:720,padding:0,ratio:1},mutations:Object(H["a"])({},W.ON_RESIZE,function(e,t){e.ratio=t}),actions:{onResize:function(e,t){var n=e.state,i=e.commit,o=t.clientWidth-2*n.padding,a=t.clientHeight-n.padding,s=o/n.width,r=n.height*s;r>a&&(s=a/n.height),i(W.ON_RESIZE,Number(s.toFixed(4)))}},getters:{}};o["default"].use(l["a"]);var G=new l["a"].Store({modules:{room:M,page:L}}),U=(n("e500"),n("420e"),n("d225")),Z=n("308d"),J=n("6bb5"),K=n("013f"),Q=n("4e2b"),X=n("90ee"),Y=function(e){function t(){var e;return Object(U["a"])(this,t),e=Object(Z["a"])(this,Object(J["a"])(t).call(this)),Object(H["a"])(Object(K["a"])(e),"getClassInfo",function(t){return e.request("playback/monitor_exists",{room_id:t})}),Object(H["a"])(Object(K["a"])(e),"testHeart",function(){return e.request("playback/heart")}),Object(H["a"])(Object(K["a"])(e),"getPlayBackInfo",function(t){return e.request("playback/info",{room_id:t})}),e}return Object(Q["a"])(t,e),t}(X["a"]),ee={install:function(e){e.prototype.Api=new Y,e.prototype.$api=e.prototype.Api}};o["default"].use(ee),o["default"].config.productionTip=!1,window.vm=new o["default"]({store:G,render:function(e){return e(D)}}).$mount("#app")},"8c13":function(e,t,n){},bfd5:function(e,t,n){e.exports=n.p+"static/img/alert-tips.55775449.png"},c88a:function(e,t,n){},e500:function(e,t,n){},efc1:function(e,t,n){},f4d3:function(e,t,n){},fb8d:function(e,t,n){"use strict";var i=n("c88a"),o=n.n(i);o.a}});
//# sourceMappingURL=video-monitor.1d9a0396.js.map