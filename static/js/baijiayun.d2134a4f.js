(function(e){function t(t){for(var a,i,s=t[0],c=t[1],l=t[2],d=0,p=[];d<s.length;d++)i=s[d],o[i]&&p.push(o[i][0]),o[i]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);u&&u(t);while(p.length)p.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],a=!0,s=1;s<n.length;s++){var c=n[s];0!==o[c]&&(a=!1)}a&&(r.splice(t--,1),e=i(i.s=n[0]))}return e}var a={},o={baijiayun:0},r=[];function i(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=a,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;r.push([12,"chunk-vendors","chunk-common"]),n()})({12:function(e,t,n){e.exports=n("4bcc")},"25d8":function(e,t,n){e.exports=n.p+"static/img/logo_xxdq.8a77ef12.png"},"26f2":function(e,t,n){},"4bcc":function(e,t,n){"use strict";n.r(t);var a=n("2b0e"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-container",{style:e.companyBackground,attrs:{id:"app"}},[n("iframe",{attrs:{id:"lessonFrame",allow:"autoplay"}}),2!=e.course.userType||e.classData?e._e():n("el-button",{staticClass:"el-icon-s-grid",attrs:{type:"danger",circle:""},on:{click:e.openHandler}}),n("el-dialog",{attrs:{title:"课件",visible:e.visible,width:e.error||0==e.treeData.length?"400px":"800px"},on:{"update:visible":function(t){e.visible=t}}},[n("el-container",{style:{"min-height":e.error||0==e.treeData.length?"20px":"280px"}},[e.error?[e._v(e._s(e.error))]:[e.treeData.length?n("el-aside",{attrs:{width:"220px"}},[n("el-collapse",{attrs:{accordion:""},model:{value:e.treeItem,callback:function(t){e.treeItem=t},expression:"treeItem"}},e._l(e.treeData,function(t){return n("el-collapse-item",{key:t.id,attrs:{title:t.name,name:t.name}},[n("el-tree",{ref:"tree_"+t.id,refInFor:!0,attrs:{data:t.children,accordion:"","node-key":"id",props:{label:"name"}},on:{"node-click":e.treeNodeClickHandler}})],1)}),1)],1):e._e(),e.selecteItem&&e.selecteItem.url?n("el-image",{attrs:{src:e.selecteItem.cover}},[n("span",{staticClass:"el-image__error",attrs:{slot:"error"},slot:"error"},[e._v(e._s(e.selecteItem.cover?"加载失败":e.selecteItem.children?"暂无预览":e.selecteItem.name+"(暂无封面)"||!1))])]):n("div",{staticStyle:{"padding-left":"40px"}},[e._v(e._s(e.treeLoading?"列表请求中....":"暂无课件"))])]],2),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取 消")]),e.selecteItem&&e.selecteItem.url?n("el-button",{attrs:{type:"primary"},on:{click:e.saveHandler}},[e._v("确 定")]):e._e()],1)],1)],1)},r=[],i=n("f499"),s=n.n(i),c=(n("28a5"),n("386d"),n("4917"),n("3b2b"),n("7618")),l=n("795b"),u=n.n(l),d=n("b05d"),p=n.n(d),f=n("66fa"),g=n.n(f),h=n("c0bc"),m=n.n(h),b=n("25d8"),y=n.n(b),v={name:"App",data:function(){return{companyType:null,classId:null,classData:null,selecteItem:null,treeItem:null,treeData:[],treeLoading:!1,visible:!1,bridge:null,course:{single:!1,action:!1,completed:!1,auth:!0,userType:1,url:null,page:1,total:1},companyList:{bk:{title:"精锐班课",logo:p.a},jxh:{title:"佳学慧",logo:g.a},zhxt:{title:"至慧学堂",logo:m.a},xxdq:{title:"小小地球",logo:y.a}},error:null}},computed:{companyBackground:function(){var e=this.companyType?this.companyList[this.companyType]:null;return e?(document.title+=" - "+e.title,{background:"url("+e.logo+") no-repeat center"}):null}},mounted:function(){var e=this;console.log("init hash --\x3e",window.location.href),this.course.userType=1==this.queryGet("userType")?2:1,this.classId=[this.queryGet("classId"),this.queryGet("docId")].join("-"),this.companyType=this.queryGet("company_code"),this.companyType||(this.error="缺少企业code, 请联系精锐技术!"),this.loadScript("https://live-cdn.baijiayun.com/js-sdk/tool/BJYBridge.js").then(function(){e.init(),e.Api.getClassDetail(e.classId).then(function(t){var n=t.success,a=t.data;n&&a?(e.classData=a,e.course.url=a.url,e.loadCourseWare()):(e.classData=null,2==e.course.userType&&(e.visible=!0,e.getList()))})}).catch(function(){})},methods:{loadScript:function(e){return new u.a(function(t,n){var a=new XMLHttpRequest;a.open("get",e,!0),a.onreadystatechange=function(){if(4==a.readyState){if(a.status>=200&&a.status<300||304==a.status){var e=document.createElement("script");e.type="text/javascript",e.text=a.responseText,document.body.appendChild(e),t()}n()}},a.onerror=function(n){console.log("error ",e),t()},a.send()})},init:function(){"object"==("undefined"===typeof document?"undefined":Object(c["a"])(document))&&(document.domain=this.getCurrentDomain(document.location.hostname)),this.frame=document.querySelector("#lessonFrame"),this.loadBridge(),console.log("init getReady",window.location.hash,this.bridge)},loadBridge:function(){var e=this;console.log("BJYBridge",window.BJYBridge),this.bridge=window.BJYBridge.getInstance({onPageChange:function(t,n){return new u.a(function(a){console.log("BJYBridge加载指定页面 --- ",t),e.course.page=t,e.frame&&e.frame.contentWindow&&e.frame.contentWindow.PageMgr&&e.frame.contentWindow.PageMgr.turnPage(t),a(n)})},onRecordChange:function(t,n){if(console.log("onRecordChange",t,n),t){var a=t[t.length-1],o=JSON.parse(a);9999==o.type?e.changeCourseWare(o.url):e.frame.contentWindow.PageMgr.receiveMsg(a)}}}),this.bridge.getReady({page:1,step:1,pageCount:1,stepCount:1})},loadCourseWare:function(){this.frame.attachEvent?this.frame.attachEvent("onload",this.loadEvent):this.frame.onload=this.loadEvent,this.frame.src="https://captive.uuabc.com/v3/index.html"},changeCourseWare:function(e){this.course.completed=!1,this.course.page=1,this.course.url=e,this.loadCourseWare()},loadEvent:function(){var e=this;this.frame.contentWindow.callbackPageLoaded=function(t,n){e.course.single=t,e.course.action=n,e.course.page=e.frame.contentWindow.PageMgr["cur_page"],console.log("加载页面 --- ",e.course)},this.frame.contentWindow.callbackSendMsg=function(t){e.bridge.replaceRecordStack(t),console.log("action msg",t)},this.frame.contentWindow.callbackSendInfo=function(e){console.log(e)},this.frame.contentWindow.callbackResLoaded=function(t){console.log("初始化",e.course,e.frame.contentWindow.PageMgr["all_page"]),e.course.completed=!0,e.course.total=t,e.frame.contentWindow.GlobalData.userType=e.course.userType,e.frame.contentWindow.GlobalData.hasAuthority(e.course.auth),e.frame.contentWindow.PageMgr.turnPage(e.course.page),e.bridge.getReady({page:1,step:1,pageCount:e.frame.contentWindow.PageMgr["all_page"],stepCount:1}),console.log("curseware init completed # getReady",e.bridge)}},queryGet:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(t);return null!=n?unescape(n[2]):null},getCurrentDomain:function(e){var t=e.split("."),n="";return n=1===t.length?t.join("."):2===t.length?t.join("."):t.splice(t.length-2).join("."),console.log(n),n},getList:function(){var e=this;this.treeLoading=!0,this.Api.getList(this.companyType).then(function(t){var n=t.success,a=t.data;e.treeData=n?a:[],e.error=n?null:"未知企业, 请联系精锐技术!",e.treeLoading=!1}).catch(function(t){e.error="未知企业, 请联系精锐技术!",e.treeLoading=!1})},treeNodeClickHandler:function(e,t,n){console.log("NODE",e,t,n),this.selecteItem=t.data},openHandler:function(){this.visible=!0,this.treeData&&0!=this.treeData.length||this.getList()},saveHandler:function(){this.classData?this.Api.updateClassDetail(this.classId,this.selecteItem.url).then(this.changeHandler):this.Api.addClassDetail(this.classId,this.selecteItem.url).then(this.changeHandler)},changeHandler:function(e){var t=e.success;t&&(this.classData={id:this.classId,url:this.selecteItem.url},this.visible=!1,this.bridge.replaceRecordStack(s()({type:9999,url:this.selecteItem.url})))}}},_=v,w=(n("a50a"),n("2877")),x=Object(w["a"])(_,o,r,!1,null,null,null),C=x.exports,j=(n("0fae"),n("5c96")),I=n("d225"),O=n("308d"),D=n("6bb5"),k=n("013f"),P=n("4e2b"),L=n("bd86"),W=n("a4bb"),T=n.n(W),A=n("b0b4"),E=n("bc3a"),S=n.n(E),B=function(){function e(){Object(I["a"])(this,e),this.prefix=null,this.url="",this.axios=S.a}return Object(A["a"])(e,[{key:"request",value:function(e,t){var n=this;return new u.a(function(a,o){n.axios.post(n.prefix+e,t||{}).then(function(e){var t=e.data.data;t&&0==T()(t).length&&(e.data.data=null),a(e.data)}).catch(o)})}}]),e}(),M=B,q=function(e){function t(){var e;return Object(I["a"])(this,t),e=Object(O["a"])(this,Object(D["a"])(t).call(this)),Object(L["a"])(Object(k["a"])(e),"getList",function(t){return e.request("/api/courseSystem/listTree",{company_code:t})}),Object(L["a"])(Object(k["a"])(e),"getClassDetail",function(t){return e.request("/api/roomCourseWare/detail",{class_id:t})}),Object(L["a"])(Object(k["a"])(e),"addClassDetail",function(t,n){return e.request("/api/roomCourseWare/create",{class_id:t,course_ware_url:n})}),Object(L["a"])(Object(k["a"])(e),"updateClassDetail",function(t,n){return e.request("/api/roomCourseWare/edit",{class_id:t,course_ware_url:n})}),e.prefix="https://uat-tob.51uuabc.com",console.log(e.prefix),e}return Object(P["a"])(t,e),t}(M),R={install:function(e){e.prototype.Api=new q}};a["default"].use(j["Image"]),a["default"].use(j["Collapse"]),a["default"].use(j["CollapseItem"]),a["default"].use(j["Tree"]),a["default"].use(j["Button"]),a["default"].use(j["Dialog"]),a["default"].use(j["Container"]),a["default"].use(j["Aside"]),a["default"].use(j["Main"]),a["default"].use(j["Loading"]),console.log("API =====",Object({NODE_ENV:"production",VUE_APP_APM_ID:"MYFpahk1547521611095",VUE_APP_COURSE_HOST:"https://uat-tob.51uuabc.com",VUE_APP_I18N_LOCALE:"zh_CN",VUE_APP_I18N_FALLBACK_LOCALE:"zh_CN",BASE_URL:""})),a["default"].use(R),a["default"].config.productionTip=!1,new a["default"]({render:function(e){return e(C)}}).$mount("#app")},"66fa":function(e,t,n){e.exports=n.p+"static/img/logo_jxh.e0a53c50.png"},a50a:function(e,t,n){"use strict";var a=n("26f2"),o=n.n(a);o.a},b05d:function(e,t,n){e.exports=n.p+"static/img/logo_bk.fdb5dd4b.png"},c0bc:function(e,t,n){e.exports=n.p+"static/img/logo_zhxt.4a4437e7.png"}});
//# sourceMappingURL=baijiayun.d2134a4f.js.map